@use '@angular/material' as mat;
@mixin form-fields-override($palettes, $colors) {
    $success: map-get($palettes, success);
    $warn-color: mat.m2-get-color-from-palette(map-get($palettes, warn));
    $alert-color: mat.m2-get-color-from-palette(map-get($palettes, alert));
    $white: map-get($colors, ob-white);
    $grey-light-20: map-get($colors, ob-grey-light-20);
    $black: map-get($colors, ob-black);
    $bg-1: map-get($colors, ob-bg-1);

    [hidden-outline] {
        width: 100%;
        margin-block: 8px;

        &.inline-field {
            padding-block: 4px;
        }

        .mdc-notched-outline__leading,
        .mdc-notched-outline__trailing,
        .mdc-notched-outline__notch {
            border: none !important;
        }

        .mdc-text-field--filled {
            --mdc-filled-text-field-active-indicator-height: 0px;
            --mdc-filled-text-field-focus-active-indicator-height: 0px;
            --mdc-filled-text-field-container-shape: 0;
            --mdc-filled-text-field-container-color: transparent;
        }

        .mdc-text-field {
            padding: 0;
        }

        .mat-mdc-form-field-infix {
            min-height: 0;
            padding: 0 !important;
        }

        .mat-mdc-form-field-focus-overlay {
            background-color: unset;
        }
    }

    .ob-form-field {
        --mat-form-field-container-text-font: Nunito Sans;
        --mat-form-field-container-text-size: 14px;
        --mat-form-field-container-text-line-height: 14px;
        --mat-form-field-container-text-weight: 400;
        --mat-form-field-subscript-text-line-height: 14px;
        --mat-form-field-subscript-text-size: 10px;

        .mat-mdc-icon-button {
            --mdc-icon-button-state-layer-size: 32px;
            padding: 4px;
            margin: 0 4px;
        }

        .mat-mdc-text-field-wrapper {
            background-color: var(--ob-theme-color-white);
            flex: none;

            &.mdc-text-field--disabled {
                background-color: var(--ob-theme-color-bg-1);
            }
        }

        .mdc-text-field--outlined {
            --mdc-shape-small: 2px;
            --mdc-outlined-text-field-label-text-font: Nunito Sans;
            --mdc-outlined-text-field-label-text-size: 14px;
            --mdc-outlined-text-field-label-text-weight: 700;
            --mdc-outlined-text-field-disabled-outline-color: var(--ob-theme-color-grey-light-20);
            --mdc-outlined-text-field-focus-outline-color: var(--ob-theme-color-black);
            --mat-form-field-outlined-label-text-populated-size: 14px;
            --mat-form-field-subscript-text-font: Nunito Sans;
            --mat-form-field-subscript-text-line-height: 14px;
            --mat-form-field-subscript-text-weight: 400;
            --mat-form-field-subscript-text-size: 10px;
            --mdc-outlined-text-field-container-shape: 2px;
            --mdc-outlined-text-field-outline-color: rgba(0, 0, 0, .265);
            --mdc-outlined-text-field-label-text-color: var(--ob-theme-color-black);
            --mdc-outlined-text-field-focus-label-text-color: var(--ob-theme-color-black);
            --mdc-outlined-text-field-hover-label-text-color: var(--ob-theme-color-black);

            padding-inline: 10px;

            .mat-mdc-form-field-infix {
                width: 40px;
                align-content: center;
                min-height: 36px;
                padding-top: 8px;
                padding-bottom: 8px;
            }
        }

        &.ob-date-form-field {
            .mat-mdc-form-field-infix .mat-mdc-form-field-label-wrapper .mat-mdc-form-field-label {
                width: 250px;
            }

            .mat-mdc-form-field-subscript-wrapper {
                width: 250px;
            }
        }

        // gives more space for the error line in short fields
        &.ob-form-field-short {
            .mat-mdc-form-field-subscript-wrapper {
                width: 200px;
            }
        }

        // made for color picker component, it fits inside matFormField with the same final height as other input mat-mdc-form-fields (36px)
        &.min-padding {
            &.field-with-label {
                min-width: 0;
            }

            .mat-mdc-form-field-infix {
                padding: 0.2em 0.15em 0.2em 0.18em;
                margin-left: -0.75em;
                margin-right: -0.75em;
                width: 100%;
            }
        }

        &.field-with-label {
            margin-top: 18px;
            margin-bottom: 8px;
            min-width: 150px;
            height: min-content;
            --mat-mdc-form-field-floating-label-scale: 1;
            --mat-form-field-subscript-text-line-height: 14px;
            --mat-form-field-subscript-text-size: 10px;

            &.inline-field {
                margin-block: 8px;

                .mat-mdc-form-field-subscript-wrapper {
                    display: none;
                }
            }

            &.no-margin {
                margin-bottom: 0;
            }

            &.no-error {
                .mat-mdc-form-field-subscript-wrapper {
                    display: none;
                }
            }

            &.label-with-icon {
                .mdc-notched-outline--upgraded {
                    .mdc-floating-label--float-above {
                        top: 10px;
                        .mat-icon {
                            width: 20px;
                            height: 20px;
                            font-size: 20px;
                        }
                    }
                }
            }

            .mat-mdc-form-field-bottom-align::before {
                height: 12px;
            }

            .mat-mdc-form-field-hint-wrapper,
            .mat-mdc-form-field-error-wrapper {
                padding-inline: 2px;
            }

            .mdc-text-field--disabled {
                --mdc-outlined-text-field-outline-color: var(--mdc-outlined-text-field-disabled-outline-color);
            }

            .mdc-notched-outline--upgraded {

                .mdc-notched-outline__leading,
                .mdc-notched-outline__trailing {
                    width: max(0px, var(--mdc-outlined-text-field-container-shape)); // default is max(12px,...
                }

                .mdc-notched-outline__notch {
                    border-top: 1px solid;
                    border-color: var(--mdc-outlined-text-field-outline-color);
                }

                .mdc-floating-label--float-above {
                    position: absolute;
                    top: 14px;
                    left: var(--mdc-outlined-text-field-container-shape);
                    --mat-mdc-form-field-label-transform: none;
                }
            }
        }
        &.inline-field .mat-mdc-form-field-subscript-wrapper {
            display: none;
        }

        &.no-padding {
            .mat-mdc-form-field-infix {
                padding: 0;
            }

            .mdc-text-field--outlined {
                padding-inline: 0;
            }

            // textarea
            textarea.mat-input-element {
                // fix scrollbar and resize icon position:
                box-sizing: border-box;
                padding: 5px 5px 5px 10px;
                margin: 0 0 1px -1px;
            }
        }

        //Used in bi-reports and bi-subscriptions. There is need for form-with-field css but without margin-top
        //because the mat-form-fields don't have labels. Maybe another approach is needed.
        &.no-margin-top {
            margin-top: 0;
        }

        &.value-field {
            margin: 0 15px;
        }

        &.mat-focused {
            .mat-mdc-form-field-icon-prefix {
                .ob-input-button {
                    line-height: 30px;
                    margin-left: 2px;
                    padding-inline-start: 11px;
                }
            }
        }

        .mat-mdc-form-field-icon-prefix {
            .ob-input-button {
                margin-left: 1px;
                padding-inline: 12px;
                border: 0;
                line-height: 32px;
                background-color: var(--ob-theme-color-primary);
                color: var(--ob-theme-color-white);
                cursor: pointer;
                .mat-icon {
                    vertical-align: middle;
                    width: 21px;
                    height: 21px;
                    font-size: 21px;
                }
            }


            .ob-button.mat-mdc-icon-button {
                height: 24px;
                width: 24px;
                min-width: 24px;
            }

            >.mat-icon {
                padding-inline: 12px;
            }

            >.ob-icon {
                padding: 0;
                margin-inline: 8px 4px;
            }
        }

        .mat-mdc-form-field-icon-suffix {
            .ob-button.mat-mdc-icon-button {
                height: 24px;
                width: 24px;
                min-width: 24px;
            }

            >.mat-icon {
                padding: 0 12px;
            }

            >.ob-icon {
                padding: 0;
                margin-inline: 4px 8px;
            }
        }

        //When a cursor not allowed is needed specifically on a mat-form-field
        &.cursor-not-allowed {
            cursor: not-allowed;
            .mat-mdc-form-field-infix {
                > * {
                    pointer-events: none;
                }
            }
        }
    }

    // yellow outlines (ie: session-planning)
    .informative-error {
        .ob-form-field.mat-mdc-form-field {
            &.mat-mdc-form-field-invalid {
                &.mat-mdc-form-field-appearance-outline.mat-mdc-form-field-invalid .mat-mdc-form-field-outline-thick {
                    // invalid
                    color: $alert-color;
                }

                .mat-mdc-form-field-label.mat-accent,
                .mat-mdc-form-field-label .mat-mdc-form-field-required-marker {
                    color: $alert-color;
                }
            }

            .mat-error {
                color: $alert-color;
            }
        }

        .invalid-field-divider {
            border-color: $alert-color;
        }
    }

    .invalid-field-divider {
        border-color: $warn-color;
    }

    // ERROR MESSAGE ICON
    .mat-mdc-form-field-subscript-wrapper .mat-icon.error-icon {
        height: 14px;
        width: 14px;
        font-size: 14px;
    }
}
