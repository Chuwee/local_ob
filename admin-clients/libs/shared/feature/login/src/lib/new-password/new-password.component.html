<div class="flex flex-col new-password-container justify-center items-center sm:justify-center">
    <form [formGroup]="form" (ngSubmit)="setNewPassword()"
        class="flex flex-col gap-6 justify-start items-stretch full-width-row">
        @if (!$isPasswordExpired()) {
            <div class="flex flex-col gap-2">
                <span class="new-pwd-title">{{'LOGIN.NEW_PASSWORD.TITLE' | translate}}</span>
                <span>{{'LOGIN.NEW_PASSWORD.INFO' | translate}}</span>
            </div>
        } @else {
            <div class="flex flex-col gap-2">
                <span class="new-pwd-title">{{'LOGIN.PASSWORD_EXPIRED.TITLE' | translate}}</span>
                @if ($maxPasswordStorage() === 1) {
                    <span>{{'LOGIN.PASSWORD_EXPIRED.INFO_CONDITION' | translate}}</span>
                } @else if ($maxPasswordStorage() > 1) {
                    <span>{{'LOGIN.PASSWORD_EXPIRED.INFO_CONDITIONS' | translate: { value: $maxPasswordStorage() } }}</span>
                }
            </div>
        }
        @if ($showPasswordPreviouslyUsed()) {
            <app-context-notification class="ob-context-notification flex justify-center items-start" contextType="warn">
                <span>{{'LOGIN.PASSWORD_EXPIRED.PREVIOUSLY_USED' | translate}}</span>
            </app-context-notification>
        }
        <div class="flex flex-col gap-2">
            <mat-form-field appearance="outline" class="ob-form-field field-with-label ml-6"
                subscriptSizing="dynamic">
                <mat-label>{{'FORMS.LABELS.NEW_PASSWORD' | translate}}</mat-label>
                <input #newPassword [type]="$showNewPasswordValue() ? 'text' : 'password'" matInput aria-label="newPassword"
                    (blur)="onNewPwdBlur()" [placeholder]="'FORMS.LABELS.NEW_PASSWORD' | translate" formControlName="newPassword">
                @if (form.get('newPassword').value) {
                    <button mat-icon-button matSuffix class="ob-button large" type="button"
                        (click)="handleShowNewPasswordValue()">
                        <mat-icon>{{$showNewPasswordValue() ? 'visibility_off' : 'visibility'}}</mat-icon>
                    </button>
                }
            </mat-form-field>
            <div class="flex flex-col gap-1">
                @for (error of (passwordConditionErrors | keyvalue); track error.key) {
                    <div class="flex justify-start items-end gap-2">
                        <mat-icon class="accomplished-condition-check ob-icon xsmall"
                            [class.accomplished]="!form.get('newPassword').hasError(error.key) && newPassword.value">
                            done
                        </mat-icon>
                        <span class="mat-caption password-condition-label"
                            [class.error]="form.hasError(error.key, 'newPassword') && $isNewPwdBlur()">
                            {{('USER.PASSWORD.' + error.value) | translate}}
                        </span>
                    </div>
                }
            </div>
        </div>
        <mat-form-field appearance="outline" class="ob-form-field field-with-label" subscriptSizing="dynamic">
            <mat-label>{{'FORMS.LABELS.CONFIRM_PASSWORD' | translate}}</mat-label>
            <input [type]="$showConfirmPasswordValue() ? 'text' : 'password'" matInput aria-label="confirmPassword"
                [placeholder]="'FORMS.LABELS.CONFIRM_PASSWORD' | translate" formControlName="confirmPassword">
            <mat-error [ob-form-errors]="form" field="confirmPassword" />
            @if (form.get('confirmPassword').value) {
                <button mat-icon-button matSuffix class="ob-button large" type="button" (click)="handleShowConfirmPasswordValue()">
                    <mat-icon>{{$showConfirmPasswordValue() ? 'visibility_off' : 'visibility'}}</mat-icon>
                </button>
            }
        </mat-form-field>
        <div class="flex items-center">
            <button mat-flat-button class="ob-button medium" color="primary" type="submit" [disabled]="$reqInProgress()">
                {{'LOGIN.NEW_PASSWORD.BTN' | translate}}
            </button>
            @if ($reqInProgress()) {
                <div class="spinner-wrapper">
                    <mat-spinner [diameter]="25" />
                </div>
            }
        </div>
    </form>
</div>