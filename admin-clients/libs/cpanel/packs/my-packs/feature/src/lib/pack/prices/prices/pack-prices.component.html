<div class="status-notifications-container flex justify-center">
    <div class="status-bar flex justify-end items-center basis-full">
        <span [matTooltip]="'CHANNELS.PACKS.PACK_PRICE_TYPES.UPDATE_RATES_DISABLED_TOOLTIP' | translate "
            [matTooltipDisabled]="!$pack().active"
            [class.disabled-section]="$pack().active">
            <button mat-stroked-button color="tertiary" type="button"
                class="ob-button small"
                [disabled]="$pack().active"
                [attr.aria-label]="'ACTIONS.REFRESH_RATES' | translate"
                (click)="refreshRates()">
                <mat-icon>autorenew</mat-icon> {{'ACTIONS.REFRESH_RATES' | translate}}
            </button>
        </span>
        <app-help-button [message]="'CHANNELS.PACKS.PACK_PRICE_TYPES.REFRESH_RATES_TOOLTIP' | translate" />
    </div>
</div>
<app-form-container [disabled]="!form.dirty || (loading$ | async)" (cancel)="cancel()" (save)="save()" class="no-padding" layout="menu">
    <form [formGroup]="form">
        <div class="details-container">
            <mat-expansion-panel expanded togglePosition="before">
                <mat-expansion-panel-header expandedHeight="*" collapsedHeight="*">
                    <mat-panel-title>{{'CHANNELS.PACKS.PACK_PRICE' | translate}}</mat-panel-title>
                </mat-expansion-panel-header>
                <p class="flex justify-start items-center">
                        <mat-icon class="ob-icon small info with-text">info</mat-icon>
                        <span>{{'CHANNELS.PACKS.PACK_PRICE_INFO' | translate}}</span>
                    </p>
                <div class="pack-form-section flex flex-col" formGroupName="pricing">
                    <mat-radio-group formControlName="type" class="flex flex-col gap-4">
                        <mat-radio-button class="ob-radio-button" [value]="'COMBINED'">
                            <div class="option-title">{{'CHANNELS.PACKS.PACK_PRICE_SUM' | translate}}</div>
                            <div>{{'CHANNELS.PACKS.PACK_PRICE_SUM_DESC' | translate}}</div>
                        </mat-radio-button>
                        @if($priceType() === 'COMBINED'){
                            <div class="flex flex-col radio-content-checkbox">
                                <mat-checkbox color="primary" [formControl]="form.controls.unified_price">
                                    <mat-label> {{ 'CHANNELS.PACKS.PACK_PRICE_SUM_CHECKBOX' | translate }} </mat-label>
                                </mat-checkbox>
                            </div>
                        }
                        <mat-radio-button class="ob-radio-button" [value]="'INCREMENTAL'">
                            <div class="option-title">{{'CHANNELS.PACKS.PACK_PRICE_INCREMENTAL' | translate}}</div>
                            <div>{{'CHANNELS.PACKS.PACK_PRICE_INCREMENTAL_DESC' | translate}}</div>
                        </mat-radio-button>
                        @if($priceType() === 'INCREMENTAL') {
                            <div>
                                <mat-form-field appearance="outline"
                                    class="ob-form-field field-with-label radio-content nested-content">
                                    <mat-label>{{'CHANNELS.PACKS.PACK_PRICES.INCREMENTAL_VALUE' | translate}}</mat-label>
                                    <app-currency-input formControlName="price_increment"
                                        [currencyCode]="currency$ | async" [currencyFormat]="'narrow'"
                                        [placeholder]="0 | localCurrency: (currency$ | async) :'narrow'" />
                                </mat-form-field>
                            </div>
                        }
                        <mat-radio-button class="ob-radio-button" [value]="'NEW_PRICE'">
                            <div class="option-title">{{'CHANNELS.PACKS.PACK_PRICE_NEW' | translate}}</div>
                            <div>{{'CHANNELS.PACKS.PACK_PRICE_NEW_DESC' | translate}}</div>
                        </mat-radio-button>
                        @if($priceType() === 'NEW_PRICE') {
                            <app-pack-price-types-matrix #ratePrices class="radio-content nested-content" [form]="priceRates"
                                [saveBtnClicked$]="saveBtnClicked$" />
                        }
                    </mat-radio-group>
                </div>
            </mat-expansion-panel>
            <mat-expansion-panel expanded togglePosition="before">
                <mat-expansion-panel-header expandedHeight="*" collapsedHeight="*">
                    <mat-panel-title>{{'PACKS.TAXES_TITLE' | translate}}</mat-panel-title>
                </mat-expansion-panel-header>
                <div class="flex flex-col">
                    <div class="flex">
                        <mat-form-field appearance="outline" class="ob-form-field field-with-label flex">
                            <mat-label>{{'PACK.TAXES.TICKET_TAX' | translate}}</mat-label>
                            <mat-select [placeholder]="'FORMS.SELECT.PLACE_HOLDER' | translate" formControlName="ticket_taxes">
                                @for (tax of $entityTaxes(); track tax) {
                                    <mat-option [value]="tax.id">
                                        {{tax.name}}
                                    </mat-option>
                                }
                            </mat-select>
                        </mat-form-field>
                    </div>
                </div>
            </mat-expansion-panel>
        </div>
    </form>
</app-form-container>
@if(loading$ | async) {
    <div class="spinner-container">
        <mat-spinner />
    </div>
}
