<div class="refunds-table-container">
    <table mat-table class="ob-table refunds-table" [dataSource]="data$ | async">
        <ng-container matColumnDef="price-type-rate" sticky>
            <th id="price-type-rate" mat-header-cell *matHeaderCellDef class="head-cell price-type-column border-right">
                {{'RESULTS.PRICEZONES' | translate}} / {{'EVENTS.RATES' | translate}}
            </th>
            <td mat-cell *matCellDef="let row" class="price-type-column border-right"
                (click)="row.type === 'PRICETYPE' && toggleExpand(row)"
                [class]="row.type === 'RATE' ? 'rate' : 'price-type'">
                <div fxLayout="column">
                    <mat-icon class="icon-toggle" *ngIf="row.type === 'PRICETYPE'">
                        {{!row.expanded ? 'expand_more' : 'expand_less'}}
                    </mat-icon>
                    <span>{{row.type === 'PRICETYPE' ? row.price_type?.name : row.rate?.name}}</span>
                    <span *ngIf="row.type === 'SUPER'" class="accent">
                        {{'EVENTS.SESSION_PACK.REFUNDS_SUPER_ROW' | translate}}
                    </span>
                    <span *ngIf="row.type !== 'PRICETYPE'" class="accent">
                        {{row.price | localCurrency: userCurrency}}
                    </span>
                    <mat-icon class="icon-error" *ngIf="row.ctrl?.errors"
                        [matTooltip]="'EVENTS.SESSION_PACK.ERRORS.ROW_SUM_ERROR' | translate"
                        matTooltipClass="ob-tooltip-error">
                        error_outline
                    </mat-icon>
                </div>
            </td>
        </ng-container>
        <ng-container *ngFor="let column of columns">
            <ng-container *ngIf="column !== 'price-type-rate'" [matColumnDef]="column">
                <th [id]="column" mat-header-cell *matHeaderCellDef class="head-cell right input-column">
                    <div fxLayout="column" class="session-header">
                        <span class="session-name">{{findSession(column).name}}</span>
                        <span class="session-date">
                            {{findSession(column).start_date | dateTime : dateTimeFormats.shortDateTimeWithWeek}}
                        </span>
                    </div>
                </th>
                <td mat-cell *matCellDef="let row" class="right editable-cell"
                    [ngClass]="row.ctrl?.errors ? 'ng-invalid error' : ''">
                    <div fxLayout="column" class="write-value percentage-value">
                        <mat-form-field appearance="outline" class="ob-form-field translucid">
                            <app-percentage-input [formControl]="row.ctrl.get(column)" class="table-input"
                                placeholder="{{ row.type === 'RATE' ? ((0 | localNumber : '1.2-2')) : '-'}}" />
                        </mat-form-field>
                        <span *ngIf="row.type === 'RATE'" class="calculated-price">
                            {{row.sessions[column]?.calculatedPercentualPrice | localCurrency: userCurrency}}
                        </span>
                    </div>
                </td>
            </ng-container>
        </ng-container>
        <tr mat-header-row *matHeaderRowDef="columns" class="dense-row"></tr>
        <tr mat-row *matRowDef="let row; columns: columns" [class]="row.type.toLowerCase() + '-row'" class="dense-row"
            [fxShow]="!row.hidden">
        </tr>
    </table>
</div>
