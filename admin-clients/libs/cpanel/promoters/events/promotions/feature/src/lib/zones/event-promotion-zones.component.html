<app-form-container [disabled]="!(form?.dirty) || (reqInProgress$ | async)" (cancel)="cancel()" (save)="save()">
    <form [formGroup]="form">
        <!-- PROMOTION SESSIONS -->
        <mat-expansion-panel expanded togglePosition="before">
            <mat-expansion-panel-header expandedHeight="*" collapsedHeight="*">
                <mat-panel-title>{{'EVENTS.PROMOTIONS.SESSIONS' | translate}}</mat-panel-title>
            </mat-expansion-panel-header>
            <div [class.atomic-saving-error]="errors.savePromotionSessions">
                <app-event-promotion-sessions [eventId]="eventId" [promotionId]="promotionId"
                    [sessionsForm]="form.get('sessions')" />
                @if(errors.savePromotionSessions) {
                    <span class="error-description">
                        {{'EVENTS.PROMOTIONS.ATOMIC_SAVING_ERROR' | translate}}
                    </span>
                }
            </div>
        </mat-expansion-panel>
        <!-- PROMOTION PRICE TYPES -->
        <mat-expansion-panel expanded togglePosition="before">
            <mat-expansion-panel-header expandedHeight="*" collapsedHeight="*">
                <mat-panel-title>{{'EVENTS.PROMOTIONS.PRICE_ZONES' | translate}}</mat-panel-title>
            </mat-expansion-panel-header>
            <div [class.atomic-saving-error]="errors.savePromotionPriceTypes">
                <app-event-promotion-price-types [eventId]="eventId" [promotionId]="promotionId" [presale]="presale"
                    [priceTypesForm]="form.get('priceTypes')" />
                @if(errors.savePromotionPriceTypes) {
                    <span class="error-description">
                        {{'EVENTS.PROMOTIONS.ATOMIC_SAVING_ERROR' | translate}}
                    </span>
                }
            </div>
        </mat-expansion-panel>
        <!-- PROMOTION RATES -->
        <mat-expansion-panel expanded togglePosition="before">
            <mat-expansion-panel-header expandedHeight="*" collapsedHeight="*">
                <mat-panel-title>{{'EVENTS.PROMOTIONS.RATES_TITLE' | translate}}</mat-panel-title>
            </mat-expansion-panel-header>
            <div [class.atomic-saving-error]="errors.savePromotionRates">
                @if ($arePromotionRatesGroupsEnabled()) {
                    <div class="flex flex-col gap-4">
                        <div class="flex flex-col gap-2">
                            <span class="mat-subtitle-2">{{'EVENTS.PROMOTIONS.RATES_DESCRIPTION' | translate}}</span>
                            <span>{{$assignedRatesNames()}}</span>
                        </div>
                        <div class="flex items-center">
                            <mat-icon class="ob-icon small info with-text">info</mat-icon>
                            {{'EVENTS.PROMOTIONS.RATES_INFO_DESCRIPTION' | translate}}
                        </div>
                    </div>
                } @else {
                    <app-event-promotion-rates [eventId]="eventId" [promotionId]="promotionId" [presale]="presale"
                        [ratesForm]="form.get('rates')" />
                    @if(errors.savePromotionRates) {
                        <span class="error-description">
                            {{'EVENTS.PROMOTIONS.ATOMIC_SAVING_ERROR' | translate}}
                        </span>
                    }
                }
            </div>
        </mat-expansion-panel>
        <!-- PROMOTION PACKS -->
        @if($isMainItemInPack() && !selfManagePromotion) {
            <mat-expansion-panel expanded togglePosition="before">
                <mat-expansion-panel-header expandedHeight="*" collapsedHeight="*">
                    <mat-panel-title>{{'EVENTS.PROMOTIONS.PACKS.TITLE' | translate}}</mat-panel-title>
                </mat-expansion-panel-header>
                <div [class.atomic-saving-error]="errors.savePromotionSessions">
                    <app-event-promotion-packs [eventId]="eventId" [promotionId]="promotionId"
                        [packsForm]="form.get('packs')" />
                    @if(errors.savePromotionPacks) {
                        <span class="error-description">
                            {{'EVENTS.PROMOTIONS.ATOMIC_SAVING_ERROR' | translate}}
                        </span>
                    }
                </div>
            </mat-expansion-panel>
        }
    </form>
    <app-archived-event-mgr slot="actions-bar" [disabled]="form.dirty" />
</app-form-container>
@if(reqInProgress$ | async) {
    <div class="spinner-container">
        <mat-spinner />
    </div>
}