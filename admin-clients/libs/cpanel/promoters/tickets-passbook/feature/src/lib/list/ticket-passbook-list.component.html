<div class="list-container" fxFlex="0 1 100%" fxLayout="column">
    <div class="heading-container" fxLayout="row wrap" fxLayoutAlign="space-between start">
        <div>
            <h1 class="secondary mat-headline-3">{{'TITLES.TICKET_PASSBOOK_TEMPLATES' | translate}}</h1>
        </div>
        <div class="actions-container" fxFlex="auto" fxLayout="row wrap" fxLayoutAlign="end">
            <div class="filter-container" fxFlex="none">
                <button mat-stroked-button color="primary" type="button" class="ob-button medium add-button"
                    [attr.aria-label]="'TICKET_PASSBOOK.NEW_BTN' | translate" (click)="openNewTicketPassbookDialog()">
                    <mat-icon>add</mat-icon>
                    {{'TICKET_PASSBOOK.NEW_BTN' | translate}}
                </button>
            </div>
        </div>
    </div>
    <div class="heading-container" fxLayout="row" fxLayoutAlign="space-between center">
        <div fxFlex="70%" fxLayoutGap="20px" fxLayoutAlign="start center">
            <div class="filter-container" fxFlex="none">
                <app-popover appFilter>
                    <app-ticket-passbook-list-filter #filterContent [canSelectEntity$]="canSelectEntity$"
                        [isAvetEntityDigitalSeasonTicket$]="isAvetEntityDigitalSeasonTicket$" [entities$]="entities$">
                    </app-ticket-passbook-list-filter>
                </app-popover>
            </div>
            <div class="search-field" fxFlex="100%">
                <app-search-input [placeholder]="'FORMS.SEARCH.TICKET_PASSBOOK_LIST' | translate"></app-search-input>
            </div>
        </div>
        <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="10px">
            <p *ngIf="ticketPassbookMetadata$ | async as ticketPassbookMetadata" class="page-summary"
                [innerHTML]="'PAGINATION.PAGE_SUMMARY' | translate: ticketPassbookMetadata">
            </p>
            <app-paginator [length]="(ticketPassbookMetadata$ | async)?.total" [pageSize]="ticketPassbookPageSize">
            </app-paginator>
        </div>
    </div>
    <div class="heading-container heading-divider">
        <mat-divider></mat-divider>
    </div>
    <div class="heading-container">
        <app-chips appFilter></app-chips>
    </div>
    <div class="spinner-container" *ngIf="ticketPassbookLoading$ | async">
        <mat-spinner></mat-spinner>
    </div>
    <mat-table class="ob-table" [dataSource]="ticketPassbook$ | async" [trackBy]="trackByFn"
        matSort [matSortActive]="initSortCol" [matSortDirection]="initSortDir" matSortDisableClear
        [attr.aria-label]="'TITLES.TICKET_PASSBOOK_TEMPLATES' | translate"
        [class.not-touchable]="(isHandsetOrTablet$ | async) !== true">

        <ng-container matColumnDef="default">
            <mat-header-cell *matHeaderCellDef class="default-cell head-cell" fxFlex="0 0 60px"></mat-header-cell>
            <mat-cell *matCellDef="let row" class="default-cell" fxFlex="0 0 60px" fxLayoutAlign="end">
                <app-default-icon *ngIf="row.type !== passbookTypes.memberOrder" (click)="$event.stopPropagation()" onlyIcon="true"
                    [enabled]="!row?.default_passbook" showWarning="true" [tplName]="row.name" [checked]="row.default_passbook"
                    [tplId]="{code: row.code, entityId: row.entity_id}" [updateDefault]="updateDefault"
                    [literals]="defaultPassbookLiterals">
                </app-default-icon>
            </mat-cell>
        </ng-container>
        <ng-container matColumnDef="name">
            <mat-header-cell *matHeaderCellDef mat-sort-header class="head-cell">{{'TICKET_PASSBOOK.NAME' | translate}}
            </mat-header-cell>
            <mat-cell *matCellDef="let row">{{row.name}}</mat-cell>
        </ng-container>
        <ng-container matColumnDef="entity">
            <mat-header-cell *matHeaderCellDef class="head-cell">{{'TICKET_PASSBOOK.ENTITY' | translate}}
            </mat-header-cell>
            <mat-cell *matCellDef="let row">{{getEntityName(row.entity_id) | async}}</mat-cell>
        </ng-container>
        <ng-container matColumnDef="create_date">
            <mat-header-cell *matHeaderCellDef mat-sort-header class="head-cell">
                {{'TICKET_PASSBOOK.CREATION_DATE' | translate}}
            </mat-header-cell>
            <mat-cell *matCellDef="let row">{{row.create_date | localDateTime : dateTimeFormats.shortDate}}</mat-cell>
        </ng-container>
        <ng-container matColumnDef="type">
            <mat-header-cell *matHeaderCellDef mat-sort-header class="head-cell">
                {{'TICKET_PASSBOOK.TYPES.TITLE' | translate}}
            </mat-header-cell>
            <mat-cell *matCellDef="let row">
                <ng-container *ngIf="row.type">
                    {{'TICKET_PASSBOOK.TYPES.' + row.type + '.TITLE' | translate}}
                </ng-container>
            </mat-cell>
        </ng-container>
        <ng-container matColumnDef="actions">
            <mat-header-cell *matHeaderCellDef class="actions-cell head-cell"
                [class.float-actions-cell]="(isHandsetOrTablet$ | async) !== true">
            </mat-header-cell>
            <mat-cell *matCellDef="let row" class="actions-cell" [class.float-actions-cell]="(isHandsetOrTablet$ | async) !== true">
                <div class="action-buttons" (click)="$event.stopPropagation()">
                    <button mat-icon-button aria-label="Delete Ticket Passbook" [matTooltip]="'TICKET_PASSBOOK.DELETE_BTN' | translate"
                        class="ob-button medium" (click)="openDeleteTicketPassbookDialog(row)">
                        <mat-icon>delete</mat-icon>
                    </button>
                </div>
            </mat-cell>
        </ng-container>
        <ng-container *ngIf="displayedColumns$ | async as displayedColumns">
            <mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></mat-header-row>
            <mat-row *matRowDef="let row; columns: displayedColumns;" class="interactive-row" [routerLink]="[row.code, 'general-data']"
                [queryParams]="{entity_id: row.entity_id}"></mat-row>
        </ng-container>
    </mat-table>
    <div class="context-notification-container" *ngIf="(ticketPassbookMetadata$ | async)?.total === 0" fxFlex="0 50 100%" fxLayout="row"
        fxLayoutAlign="center start">
        <app-context-notification class="ob-context-notification" contextType="info" fxFlex.gt-sm="600px" fxFlex="80%"
            fxLayoutAlign="center start">
            <p>{{'LIST.EMPTY' | translate}}</p>
        </app-context-notification>
    </div>
</div>