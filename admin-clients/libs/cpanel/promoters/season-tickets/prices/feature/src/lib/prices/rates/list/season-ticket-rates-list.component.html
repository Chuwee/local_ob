<div class="rates-container">
    <form [formGroup]="ratesForm">
        @let vmSeasonTicketRates = $vmSeasonTicketRates();
		<div class="new-rate-container flex">
		<mat-form-field appearance="outline" class="ob-form-field field-with-label inline-field flex flex-auto">
			<mat-label>{{'SEASON_TICKET.RATES_LIST' | translate}}</mat-label>
        <input matInput id="new-rate-input"
            [placeholder]="'SEASON_TICKET.WRITE_NEW_RATE' | translate"
            [formControl]="newRateNameCtrl" (keyup.enter)="addNewRate($event)">
        </mat-form-field>
        <div class="new-rate-action">
            <button mat-stroked-button color="primary" type="button" class="ob-button medium add-button"
                [attr.aria-label]="'SEASON_TICKET.NEW_RATE_BTN' | translate" (click)="addNewRate($event)"
                [disabled]="newRateNameCtrl.invalid || !newRateNameCtrl.value">
                <mat-icon>add</mat-icon>
                {{'SEASON_TICKET.NEW_RATE_BTN' | translate}}
            </button>
        </div>
</div>
<div class="translate-rates-action flex justify-end">
    <button mat-button type="button" class="ob-button medium translate-rates-button"
        [attr.aria-label]="'EVENTS.TRANSLATE_RATES_BTN' | translate" (click)="openTranslateRatesDialog()"
        [disabled]="!vmSeasonTicketRates?.length">
        <mat-icon>translate</mat-icon>
        {{'EVENTS.TRANSLATE_RATES_BTN' | translate}}
    </button>
</div>
@if (vmSeasonTicketRates?.length) {
    <mat-list cdkDropList [cdkDropListData]="vmSeasonTicketRates" formArrayName="rateNamesList" class="ob-list" role="list"
        (cdkDropListDropped)="onListDrop($event)">
        @for (rate of vmSeasonTicketRates; track rate.id; let i = $index) {
            <mat-list-item cdkDrag cdkDragLockAxis="y" cdkDragBoundary=".ob-list" class="editable-item" role="listitem">
                <mat-icon class="drag-icon" cdkDragHandle>
                    drag_indicator
                </mat-icon>
                <mat-button-toggle aria-label="Set default rate"
                    class="ob-icon-button-toggle-simple yellow-icon-appearance ob-button medium only-icon"
                    [checked]="rate.default" [disabled]="rate.default"
                    (click)="setDefaultRate(rate)">
                    <mat-icon [class]="rate.default ? 'selected' : 'not-selected'" [matTooltip]="'SEASON_TICKET.DEFAULT_RATE' | translate"
                        [matTooltipDisabled]="!rate.default">
                        {{rate.default ? 'star' : 'star_border'}}
                    </mat-icon>
                </mat-button-toggle>
                <mat-button-toggle aria-label="Set restrictive access" class="ob-icon-button-toggle-simple ob-button medium only-icon"
                    [checked]="rate.restrictive_access" (click)="setRestrictiveAccess(rate)"
                    [matTooltip]="('SEASON_TICKET.SET_RESTRICTIVE_ACCESS_RATE_' + !rate.restrictive_access | uppercase) | translate">
                    <mat-icon [class]="rate.restrictive_access ? 'selected' : 'not-selected'">
                        new_releases
                    </mat-icon>
                </mat-button-toggle>
                <div class="write-value flex flex-auto">
                    <input #rateInput id="rate-input{{i}}" type="text" [formControl]="rate.nameCtrl"
                        (blur)="saveName(rateInput, rate)" class="rate-input" [class.invalid]="rate.nameCtrl.invalid">
                </div>
                <div class="delete-action">
                    @if (!rate.default && !ratesForm.invalid) {
                        <button type="button" mat-icon-button
                            aria-label="Delete rate" class="ob-button medium" (click)="deleteRate(rate)">
                            <mat-icon>delete</mat-icon>
                        </button>
                    }
                </div>
                <mat-button-toggle aria-label="Set visible/not visible rate" class="ob-icon-button-toggle-simple ob-button small only-icon"
                    (click)="setEnable(rate)" [checked]="rate.enabled" [disabled]="rate.default"
                    [matTooltip]="('SEASON_TICKET.SET_VISIBLE_RATE_' + !rate.enabled | uppercase) | translate">
                    <mat-icon>visibility</mat-icon>
                </mat-button-toggle>
            </mat-list-item>
        }
    </mat-list>
}
</form>
</div>