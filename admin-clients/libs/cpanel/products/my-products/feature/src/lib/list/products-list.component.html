<div class="list-container" fxFlex="100%" fxLayout="column">
    <div class="heading-container without-overflow-hidden" fxLayout="row wrap" fxLayoutAlign="space-between start">
        <div>
            <h1 class="secondary mat-headline-3">{{'TITLES.MY_PRODUCTS' | translate}}</h1>
        </div>
        <div class="actions-container" fxFlex="auto" fxLayout="row wrap" fxLayoutAlign="end">
            <div class="filter-container" fxFlex="none">
                @if (canWrite$ | async) {
                    <button mat-stroked-button color="primary" type="button" class="ob-button medium add-button"
                        [attr.aria-label]="'PRODUCT.NEW_BTN' | translate" (click)="openNewProductDialog()">
                        <mat-icon>add</mat-icon>
                        {{'PRODUCT.NEW_BTN' | translate}}
                    </button>
                }
            </div>
        </div>
    </div>
    <div class="heading-container without-overflow-hidden" fxLayout="row" fxLayoutAlign="space-between center">
        <div fxFlex="70%" fxLayoutGap="20px" fxLayoutAlign="start center">
            <div class="filter-container" fxFlex="none">
                <app-popover appFilter>
                    <app-products-list-filter #filterContent [canSelectEntity$]="canReadMultipleEntities$" />
                </app-popover>
            </div>
            <div class="search-field" fxFlex="100%">
                <app-search-input [placeholder]="'FORMS.SEARCH.CHANNEL_LIST' | translate" />
            </div>
        </div>
        <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="10px">
            @if (productsMetadata$ | async; as productsMetadata) {
                <p class="page-summary"
                    [innerHTML]="'PAGINATION.PAGE_SUMMARY' | translate: productsMetadata">
                </p>
            }
            <app-paginator [length]="(productsMetadata$ | async)?.total" [pageSize]="productsPageSize" />
        </div>
    </div>
    <div class="heading-container heading-divider">
        <mat-divider />
    </div>
    <div class="heading-container">
        <app-chips appFilter />
    </div>
    @if (productsLoading$ | async) {
        <div class="spinner-container">
            <mat-spinner />
        </div>
    }

    <mat-table class="ob-table" [dataSource]="(products$ | async)" [trackBy]="trackByFn"
        matSort [matSortActive]="initSortCol" [matSortDirection]="initSortDir" matSortDisableClear
        [attr.aria-label]="'TITLES.MY_PRODUCTS' | translate"
        [ngClass]="{'not-touchable': (isHandsetOrTablet$ | async) !== true}">
        <ng-container matColumnDef="name">
            <mat-header-cell *matHeaderCellDef mat-sort-header class="head-cell">{{'PRODUCT.NAME' | translate}}
            </mat-header-cell>
            <mat-cell *matCellDef="let row">{{row.name}}</mat-cell>
        </ng-container>
        <ng-container matColumnDef="entity_name">
            <mat-header-cell *matHeaderCellDef class="head-cell">{{'PRODUCT.ENTITY' | translate}}
            </mat-header-cell>
            <mat-cell *matCellDef="let row">{{row.entity.name}}</mat-cell>
        </ng-container>
        <ng-container matColumnDef="stock_type">
            <mat-header-cell *matHeaderCellDef class="head-cell">{{'PRODUCT.STOCK_TYPE.LABEL' | translate}}
            </mat-header-cell>
            <mat-cell *matCellDef="let row">{{ 'PRODUCT.STOCK_TYPE_OPTS.' + row.stock_type | translate}}</mat-cell>
        </ng-container>
        <ng-container matColumnDef="status">
            <mat-header-cell *matHeaderCellDef class="head-cell">{{'PRODUCT.STATUS' | translate}}
            </mat-header-cell>
            <mat-cell *matCellDef="let row">
                <span [ngClass]="['status-dot', row.product_state?.toLowerCase() || '']"></span>
                <span>{{'PRODUCT.STATUS_OPTS.' + row.product_state | translate}}</span>
            </mat-cell>
        </ng-container>
        <ng-container matColumnDef="product_type">
            <mat-header-cell *matHeaderCellDef class="head-cell">{{'PRODUCT.TYPE' | translate}}
            </mat-header-cell>
            <mat-cell *matCellDef="let row">{{'PRODUCT.TYPE_OPTS.' + row.product_type | translate}}</mat-cell>
        </ng-container>
        <ng-container matColumnDef="currency">
            <mat-header-cell *matHeaderCellDef class="head-cell">{{'EVENTS.CURRENCY.LABEL' | translate}}
            </mat-header-cell>
            <mat-cell *matCellDef="let row">{{row.currency_code | localCurrencyPartialTranslation}}</mat-cell>
        </ng-container>
        @if (canWrite$ | async) {
            <ng-container matColumnDef="actions">
                <mat-header-cell *matHeaderCellDef class="actions-cell head-cell"
                    [class.float-actions-cell]="(isHandsetOrTablet$ | async) !== true" />
                <mat-cell *matCellDef="let row" class="actions-cell" [class.float-actions-cell]="(isHandsetOrTablet$ | async) !== true">
                    <div class="action-buttons" (click)="$event.stopPropagation()">
                        <button mat-icon-button aria-label="Delete product" class="ob-button medium"
                            [matTooltip]="'PRODUCT.DELETE_BTN' | translate" (click)="openDeleteProductDialog(row)">
                            <mat-icon>delete</mat-icon>
                        </button>
                    </div>
                </mat-cell>
            </ng-container>
        }
        @if ((displayedColumns$ | async); as displayedColumns) {

            <mat-header-row *matHeaderRowDef="displayedColumns; sticky: true" />
            <mat-row *matRowDef="let row; columns: displayedColumns;" class="interactive-row"
                [routerLink]="[row.product_id, 'general-data']" />

        }
    </mat-table>
    @if (((productsMetadata$ | async)?.total === 0) && hasAppliedFilters) {
        <div class="context-notification-container" fxFlex="100%" fxLayout="row" fxLayoutAlign="center start">
            <app-context-notification class="ob-context-notification" contextType="info"
                fxFlex.gt-sm="600px" fxFlex="80%" fxLayoutAlign="center start">
                <p>{{'LIST.EMPTY' | translate}}</p>
            </app-context-notification>
        </div>
    }
    @if (((productsMetadata$ | async)?.total === 0) && !hasAppliedFilters) {

        @if (canWrite$ | async) {
            <app-empty-state fxFlex="100%"
                [title]="'PRODUCT.LIST.EMPTY_LIST_TITLE' | translate"
                [description]="'PRODUCT.LIST.EMPTY_LIST_DESCRIPTION' | translate">
                <button type="button" mat-flat-button class="ob-button medium"
                    color="primary" (click)="openNewProductDialog()">
                    <mat-icon>add</mat-icon>
                    {{'PRODUCT.NEW_BTN' | translate}}
                </button>
            </app-empty-state>
        }

    }
</div>
