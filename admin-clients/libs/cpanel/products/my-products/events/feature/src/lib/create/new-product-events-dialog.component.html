<div class="dialog-msg-container" fxLayout="column nowrap" fxFlex="100%">
    <div mat-dialog-title fxFlex="auto" fxLayout="row" fxFlexAlign="start">
        <h2 fxFlex="100%" class="secondary title">{{'PRODUCT.EVENTS.NEW_EVENTS' | translate}}</h2>
        <button mat-icon-button type="button" class="ob-button small" (click)="close()">
            <mat-icon>close</mat-icon>
        </button>
    </div>
    <div mat-dialog-content fxLayout="column" fxLayoutAlign="start stretch">
        <form [formGroup]="form" fxLayout="column" fxLayoutAlign="start stretch">
            <div fxFlex="100%" fxLayout="column">
                <p>{{'PRODUCT.EVENTS.SELECTION_LABEL' | translate}}</p>
                <mat-radio-group formControlName="selectAll" fxFlex="100%" fxLayout="column">
                    <mat-radio-button [value]="true" class="ob-radio-button vertical-list">
                        <div>{{'PRODUCT.EVENTS.SELECTION_ALL' | translate}}</div>
                    </mat-radio-button>
                    <mat-radio-button [value]="false" class="ob-radio-button vertical-list">
                        <div>{{'PRODUCT.EVENTS.SELECTION_RESTRICTED' | translate}}</div>
                    </mat-radio-button>
                </mat-radio-group>
                @if (form.get('selectAll').value === false) {
                    <div class="nested-content"
                        [class.field-error]="form.get('events').hasError('atLeastOneRequired') && form.touched">
                        <app-searchable-paginated-selection class="ob-medium-list"
                            [placeholder]="'PRODUCT.EVENTS.SELECTION_LIST_PLACEHOLDER' | translate"
                            [pageSize]="pageSize" [form]="form.get('events')"
                            [loading$]="isInProgress$" [data$]="eventsData$" [metadata$]="metadata$"
                            (loadData)="reloadEventsList($event)">
                            <ng-template #selectionTemplate let-pageForm="pageForm" let-data="data" let-selectionChanged="selectionChanged">
                                @if (selectedEvents$ | async) {
                                    <app-selection-list [disabledOptionPredicate]="isEventDisabled"
                                        [data]="data" [pageForm]="pageForm" [selectionChanged]="selectionChanged" class="small-rows">
                                        <div slot="subheader" class="list-header">
                                            <div fxLayoutAlign="space-between" fxFlex="0 1 100%">
                                                <div>
                                                    <mat-checkbox color="primary"
                                                        (change)="handleRestrictedSelectionGroupChange($event.checked)"
                                                        [checked]="form.get('events').value.length === (metadata$ | async).total"
                                                        [indeterminate]="form.get('events').value.length > 0
                                                    && form.get('events').value.length < (metadata$ | async).total" />
                                                    <span>{{'FORMS.LABELS.EVENTS' | translate}}</span>
                                                </div>
                                            </div>
                                        </div>
                                        <ng-template #optionTemplate let-row>
                                            <span>{{row.name}}</span>
                                        </ng-template>
                                    </app-selection-list>
                                }
                            </ng-template>
                        </app-searchable-paginated-selection>
                        @if (form.get('events').hasError('atLeastOneRequired') && form.get('events').touched) {
                            <mat-error>
                                {{'PRODUCT.EVENTS.NEW_EVENT.AT_LEAST_ONE_REQUIRED' | translate}}
                            </mat-error>
                        }
                    </div>
                }
            </div>

        </form>
    </div>
    <div mat-dialog-actions fxLayout="row" fxLayoutAlign="end">
        <button type="button" mat-button class="ob-button" (click)="close()">
            {{'FORMS.ACTIONS.CANCEL' | translate}}
        </button>
        <button mat-flat-button color="primary" type="button" class="ob-button" (click)="addProductEvents()"
            [disabled]="!form.dirty || (isInProgress$ | async)">
            {{'FORMS.ACTIONS.ADD' | translate}}
        </button>
    </div>
</div>
@if (isInProgress$ | async) {
    <div class="spinner-container">
        <mat-spinner />
    </div>
}