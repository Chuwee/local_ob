@let form = $form();
@if (form && $formFields()) {
    <ng-container [formGroup]="form">
        <div class="flex flex-col">
            <mat-table class="ob-table channel-form-table" [dataSource]="$formsArray()"
                [formGroup]="form.get('0')">
                <!-- Visible checkbox column -->
                <ng-container matColumnDef="visible">
                    <mat-header-cell *matHeaderCellDef
                        class="head-cell visible checkbox-column justify-center align-center flex-[0_0_42px]"/>
                    <mat-cell *matCellDef="let row; index as i" [formArrayName]="i"
                        class="icon-cell visible checkbox-column justify-center align-center flex-[0_0_42px]">
                        <mat-checkbox color="primary" formControlName="visible" />
                    </mat-cell>
                </ng-container>
                <!-- Field name column -->
                <ng-container matColumnDef="name">
                    <mat-header-cell *matHeaderCellDef class="head-cell name">
                        {{ 'CHANNEL_FORM_CONFIG.FORM_FIELDS.HEADER' | translate }}
                    </mat-header-cell>
                    <mat-cell *matCellDef="let row" class="name">
                        {{ 'CHANNEL_FORM_CONFIG.FORM_FIELDS.' + row.key?.toUpperCase() | translate }}
                    </mat-cell>
                </ng-container>
                <!-- Purchase-required checkbox column -->
                <ng-container matColumnDef="required">
                    <mat-header-cell *matHeaderCellDef class="head-cell purchase-required checkbox-column justify-center align-center">
                        {{'CHANNEL_FORM_CONFIG.FORM_FIELDS.REQUIRED' | translate}}
                    </mat-header-cell>
                    <mat-cell *matCellDef="let row; index as i" [formArrayName]="i"
                        class="icon-cell purchase-required checkbox-column justify-center align-center">
                        <mat-checkbox color="primary" formControlName="mandatory" />
                    </mat-cell>
                </ng-container>
                <!-- uneditable checkbox column -->
                <ng-container matColumnDef="uneditable">
                    <mat-header-cell *matHeaderCellDef class="head-cell uneditable checkbox-column justify-center align-center">
                        {{'CHANNEL_FORM_CONFIG.FORM_FIELDS.UNEDITABLE' | translate}}
                    </mat-header-cell>
                    <mat-cell *matCellDef="let row; index as i" [formArrayName]="i"
                        class="icon-cell uneditable checkbox-column justify-center align-center">
                        <mat-checkbox color="primary" formControlName="uneditable" />
                    </mat-cell>
                </ng-container>
                <!-- Rules-badge column -->
                <ng-container matColumnDef="rules-badge">
                    <mat-header-cell *matHeaderCellDef class="head-cell rules-badge justify-start align-center">
                        {{'CHANNEL_FORM_CONFIG.VALIDATIONS.HEADER' | translate}}
                    </mat-header-cell>
                    <mat-cell *matCellDef="let row; index as i" class="rules-badge justify-start align-center">
                        @if (form.get(['0', i, 'rules']).value?.length) {
                            <div class="badge">
                                {{'CHANNEL_FORM_CONFIG.FORM_FIELDS.HAS_VALIDATIONS' | translate}}
                            </div>
                        }
                    </mat-cell>
                </ng-container>
                <!-- Rules-editor buttons column -->
                <ng-container matColumnDef="rules-editor">
                    <mat-header-cell *matHeaderCellDef class="actions-cell head-cell flex-none basis-[50px]" />
                    <mat-cell *matCellDef="let row; index as i" class="actions-cell flex-none basis-[50px] justify-end">
                        @if (row.available_rules?.length) {
                            <div (click)="$event.stopPropagation()">
                                <button mat-icon-button [matMenuTriggerFor]="actionsListMenu" #menuTrigger="matMenuTrigger"
                                    class="ob-button medium">
                                    <mat-icon>more_horiz</mat-icon>
                                </button>
                                <mat-menu #actionsListMenu="matMenu" xPosition="before" (close)="menuTrigger">
                                    <button mat-menu-item [attr.aria-label]="'CHANNEL_FORM_CONFIG.VALIDATIONS_EDITION' | translate"
                                        (click)="openRulesEditorDialog('0', row)">
                                        {{'CHANNEL_FORM_CONFIG.VALIDATIONS_EDITION' | translate}}
                                    </button>
                                </mat-menu>
                            </div>
                        }
                    </mat-cell>
                </ng-container>
                <mat-header-row *matHeaderRowDef="$formsColumns();sticky: true" class="dense-row" />
                <mat-row *matRowDef="let row; columns: $formsColumns()" class="dense-row hoverable-row" />
            </mat-table>
        </div>
    </ng-container>
}
