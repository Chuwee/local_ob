<app-form-container layout="menu" class="overflow-y-auto" [formGroup]="form" (cancel)="cancel()" (save)="save()"
    [disabled]="(isInProgress$ | async) || !form.dirty">
    @if(faqsList$ | async; as faqsList) {
        <div fxLayoutAlign="end" [fxHide]="!faqsList || faqsList.length === 0">
            <button mat-stroked-button color="primary" class="ob-button medium add-button"
                [attr.aria-label]="'CHANNELS.FAQS.NEW' | translate"
                (click)="openNewFaq()">
                <mat-icon>add</mat-icon>
                {{'CHANNELS.FAQS.NEW' | translate}}
            </button>
        </div>

        <div class="filter-container" fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="8px">
            @if(categoryTypes$ | async; as categoryTypes) {
                @if(categoryTypes.length > 1){
                    <app-channel-faqs-filter [categories]="categoryTypes"
                        (filterChange)="loadFilteredFaqs($event)" />
                }
            }
            <app-search-input fxFlex="0 1 510px" [placeholder]="'FORMS.SEARCH.IN_LIST' | translate"
                (valueChanged)="loadFilteredFaqs({q: $event})" />
        </div>

        <div class="table-container">
            <mat-table #faqsTable class="ob-table dense-table" [dataSource]="faqsList"
                [class.not-touchable]="(isHandsetOrTablet$ | async) !== true" cdkDropList
                (cdkDropListDropped)="onDropCondition($event, faqsList)"
                [cdkDropListDisabled]="dropDisabled()">
                <ng-container matColumnDef="title">
                    <mat-header-cell *matHeaderCellDef class="head-cell">
                        {{'CHANNELS.FAQS.CONTENT_TITLE' | translate}}
                    </mat-header-cell>
                    <mat-cell *matCellDef="let row; index as i" fxLayoutAlign="start center" [formArrayName]="i"
                        class="icon-cell">
                        @if(canDrop) {
                            <mat-icon class="drag-icon">drag_indicator</mat-icon>
                        }
                        <span>{{row.values[defaultLang.getValue()].title}}</span>
                    </mat-cell>
                </ng-container>
                <ng-container matColumnDef="content">
                    <mat-header-cell *matHeaderCellDef class="head-cell">
                        {{'CHANNELS.FAQS.TABLE_FAQ_CONTENT' | translate}}
                    </mat-header-cell>
                    <mat-cell *matCellDef="let row; index as i" fxLayoutAlign="start center" [formArrayName]="i">
                        <span class="ellipsify-no-wrap" appEllipsify>{{row.values[defaultLang.getValue()].content}}</span>
                    </mat-cell>
                </ng-container>
                <ng-container matColumnDef="categories">
                    <mat-header-cell *matHeaderCellDef class="head-cell">
                        {{'CHANNELS.FAQS.TABLE_FAQ_CATEGORIES' | translate}}
                    </mat-header-cell>
                    <mat-cell *matCellDef="let row; index as i" fxLayoutAlign="start center" [formArrayName]="i">
                        <div fxLayout="row wrap" fxLayoutGap="4px">
                            @for (category of row.tags; track $index) {
                                <span class="ob-status-badge neutral">{{'CHANNELS.FAQS.CATEGORY_OPTS.'+category | translate}}</span>
                            }
                        </div>
                    </mat-cell>
                </ng-container>
                <ng-container matColumnDef="actions">
                    <mat-header-cell *matHeaderCellDef class="two-actions-cell head-cell" />
                    <mat-cell *matCellDef="let row; index as i" class="two-actions-cell" fxLayoutAlign="end"
                        [class.float-actions-cell]="(isHandsetOrTablet$ | async) !== true">
                        <div class="action-buttons" (click)="$event.stopPropagation()">
                            <button mat-icon-button
                                [matTooltip]="'CHANNELS.FAQS.EDIT' | translate"
                                aria-label="Edit payment method" class="ob-button medium"
                                (click)="openEditFaq(row.key)">
                                <mat-icon>edit</mat-icon>
                            </button>
                            <button
                                [matTooltip]="'CHANNELS.FAQS.DELETE' | translate" mat-icon-button
                                aria-label="Delete payment method" class="ob-button medium"
                                (click)="delete(row.key)">
                                <mat-icon>delete</mat-icon>
                            </button>
                        </div>
                    </mat-cell>
                </ng-container>
                <mat-header-row *matHeaderRowDef="(columns$ | async); sticky: true"
                    class="dense-row" />
                <mat-row *matRowDef="let row; columns: (columns$ | async); let index = dataIndex"
                    class="hoverable-row dense-row" [class.ob-draggable-row]="canDrop" cdkDrag cdkDragBoundary=".mat-table" />
            </mat-table>
            <app-empty-state-tiny [fxShow]="!faqsList || faqsList.length === 0"
                [title]="'CHANNELS.FAQS.TABLE_EMPTY_LIST' | translate"
                [description]="'CHANNELS.FAQS.TABLE_EMPTY_LIST_DESCRIPTION' | translate"
                [emptyBorder]="true">
                <button mat-stroked-button type="button" class="ob-button medium"
                    color="primary" (click)="openNewFaq()">
                    <mat-icon>add</mat-icon>
                    {{'CHANNELS.FAQS.NEW' | translate}}
                </button>
            </app-empty-state-tiny>
        </div>
    }
    @if(isInProgress$ | async) {
        <div class="spinner-container">
            <mat-spinner />
        </div>
    }
</app-form-container>