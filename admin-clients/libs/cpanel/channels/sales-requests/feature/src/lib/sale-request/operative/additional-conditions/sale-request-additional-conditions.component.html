<app-form-container (cancel)="cancel()" (save)="save()" layout="menu" [disabled]="(loadingOrSaving$ | async) || !form.dirty">
    <mat-accordion [multi]="true" [togglePosition]="'before'" [formGroup]="form" *ngIf="saleRequest">
        <p>{{ 'SALE_REQUEST.ADDITIONAL_CONDITIONS_DESC' | translate }}</p>
        <div fxLayout="row">
            <div fxFlex="0 1 680px" fxLayout="column" *ngIf="additionalConditions$ | async as additionalConditions">
                <div class="new-condition-action" fxLayout="row" fxLayoutAlign="end">
                    <div fxFlex></div>
                    <div [matTooltip]="(saleRequest.languages.selected ? 'CHANNELS.OPTIONS.NEW_CONDITION_NOT_ALLOWED' : 'CHANNELS.OPTIONS.SOME_LANGUAGE_NEEDED') | translate"
                        [matTooltipDisabled]="saleRequest.languages.selected && (additionalConditions.length < MAX_ADDITIONAL_CONDITIONS)">
                        <button mat-stroked-button color="primary" type="button" class="ob-button small add-button"
                            (click)="(additionalConditions.length < MAX_ADDITIONAL_CONDITIONS) && openAdditionalConditionDialog(saleRequest.id)"
                            [disabled]="additionalConditions.length >= MAX_ADDITIONAL_CONDITIONS || !saleRequest.languages.selected">
                            <mat-icon>add</mat-icon>
                            {{'CHANNELS.OPTIONS.NEW_CONDITION_BTN' | translate}}
                        </button>
                    </div>
                </div>
                <mat-table #conditionsTable class="ob-table" [dataSource]="additionalConditions$" formGroupName="additionalConditions"
                    [class.not-touchable]="(isHandsetOrTablet$ | async) !== true">
                    <!-- enabled checkbox column -->
                    <ng-container matColumnDef="condition-enabled">
                        <mat-header-cell *matHeaderCellDef class="head-cell condition-enabled checkbox-column" fxFlex="48px">
                        </mat-header-cell>
                        <mat-cell *matCellDef="let row; index as i" [formArrayName]="i" class="icon-cell condition-enabled checkbox-column"
                            fxFlex="48px" fxLayoutAlign="start center">
                            <mat-checkbox color="primary" formControlName="conditionEnabled">
                            </mat-checkbox>
                        </mat-cell>
                    </ng-container>
                    <!-- Field name column -->
                    <ng-container matColumnDef="name">
                        <mat-header-cell *matHeaderCellDef class="head-cell name">
                            {{ 'CHANNELS.OPTIONS.ADDITIONAL_CONDITION_NAME'| translate }}
                        </mat-header-cell>
                        <mat-cell *matCellDef="let row" class="name">
                            {{ row.name }}
                        </mat-cell>
                    </ng-container>
                    <!-- required checkbox column -->
                    <ng-container matColumnDef="condition-required">
                        <mat-header-cell *matHeaderCellDef class="head-cell condition-required checkbox-column"
                            fxLayoutAlign="center center">
                            {{'CHANNELS.OPTIONS.CONDITION_REQUIRED' | translate}}
                        </mat-header-cell>
                        <mat-cell *matCellDef="let row; index as i" [formArrayName]="i" class="icon-cell condition-required checkbox-column"
                            fxLayoutAlign="center center">
                            <mat-checkbox color="primary" formControlName="conditionRequired">
                            </mat-checkbox>
                        </mat-cell>
                    </ng-container>
                    <!-- actions column -->
                    <ng-container matColumnDef="actions">
                        <mat-header-cell *matHeaderCellDef class="two-actions-cell head-cell"
                            [class.float-actions-cell]="(isHandsetOrTablet$ | async) !== true">
                        </mat-header-cell>
                        <mat-cell *matCellDef="let row" class="two-actions-cell"
                            [class.float-actions-cell]="(isHandsetOrTablet$ | async) !== true">
                            <div class="action-buttons" (click)="$event.stopPropagation()">
                                <button mat-icon-button class="ob-button medium"
                                    [matTooltip]="'CHANNELS.OPTIONS.CONDITION_EDIT_BTN' | translate"
                                    (click)="openAdditionalConditionDialog(saleRequest.id, row)">
                                    <mat-icon>edit</mat-icon>
                                </button>
                                <button mat-icon-button class="ob-button medium"
                                    [matTooltip]="'CHANNELS.OPTIONS.CONDITION_DELETE_BTN' | translate"
                                    (click)="openDeleteConditionDialog(saleRequest.id, row)">
                                    <mat-icon>delete</mat-icon>
                                </button>
                            </div>
                        </mat-cell>
                    </ng-container>
                    <mat-header-row *matHeaderRowDef="additionalConditionsColumns" class="dense-row">
                    </mat-header-row>
                    <mat-row *matRowDef="let row; columns: additionalConditionsColumns" class="dense-row hoverable-row">
                    </mat-row>
                </mat-table>
                <div class="context-notification-container" fxLayout="row" fxLayoutAlign="center start"
                    *ngIf="!additionalConditions.length">
                    <app-context-notification class="ob-context-notification" contextType="info" fxFlex="100%"
                        fxLayoutAlign="center center">
                        {{'LIST.EMPTY' | translate}}
                    </app-context-notification>
                </div>
            </div>
        </div>
    </mat-accordion>
</app-form-container>
