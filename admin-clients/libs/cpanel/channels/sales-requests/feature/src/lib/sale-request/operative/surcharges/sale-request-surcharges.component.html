<app-form-container (cancel)="cancel()" (save)="save()" layout="menu" [disabled]="$isInProgress() || !form.dirty">
    <mat-accordion [multi]="true" [togglePosition]="'before'">
        <mat-expansion-panel [expanded]="true">
            <mat-expansion-panel-header expandedHeight="*" collapsedHeight="*">
                <mat-panel-title>{{'SALE_REQUEST.SURCHARGES.TITLE' | translate}}</mat-panel-title>
            </mat-expansion-panel-header>
            <div class="section-block">
                <p class="section-description">{{'SALE_REQUEST.SURCHARGES.DESCRIPTION' | translate}}</p>
            </div>
            <div class="section-block">
                <app-sale-request-surcharges-generic [currency]="$currency()" [form]="form"
                    [surchargesRequestCtrl]="surchargesRequestCtrl" />
            </div>
            <div class="section-block">
                <app-sale-request-surcharges-promotion [currency]="$currency()" [form]="form"
                    [surchargesRequestCtrl]="surchargesRequestCtrl" />
            </div>
            @if(($saleRequest() | isSaleRequestWebChannel) === false){
                <div>
                    <app-sale-request-surcharges-invitation [currency]="$currency()" [form]="form"
                        [surchargesRequestCtrl]="surchargesRequestCtrl" />
                </div>
            }
        </mat-expansion-panel>
        <mat-expansion-panel expanded>
            <mat-expansion-panel-header>
                <mat-panel-title>
                    {{ 'SALE_REQUEST.SURCHARGES.TITLES.TAXES' | translate }}
                </mat-panel-title>
            </mat-expansion-panel-header>
            <app-sale-request-surcharges-taxes [form]="form" />
        </mat-expansion-panel>
        <!-- TODO: Remove isTestTaxes when  taxes end -->
        @if(isTestTaxes ? ($saleRequest()?.event?.tax_mode && $saleRequest()?.event?.tax_mode !== taxesMode.onTop) : true){
            <mat-expansion-panel (afterExpand)="simulationExpanded = true" (afterCollapse)="simulationExpanded = false">
                <mat-expansion-panel-header expandedHeight="*" collapsedHeight="*">
                    <mat-panel-title>{{'SALE_REQUEST.PRICE_SIMULATION.TITLE' | translate}}</mat-panel-title>
                </mat-expansion-panel-header>
                <app-sale-request-price-simulation [expanded]="simulationExpanded" />
            </mat-expansion-panel>
        }
    </mat-accordion>
</app-form-container>
@if($isInProgress()){
    <div class="spinner-container">
        <mat-spinner />
    </div>
}