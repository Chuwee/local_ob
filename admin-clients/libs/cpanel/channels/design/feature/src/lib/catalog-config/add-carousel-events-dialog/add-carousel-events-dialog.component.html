<div class="dialog-msg-container">
    <div class="dialog-header-container" fxLayout="row" mat-dialog-title>
        <h2 fxFlex="100%" fxLayoutAlign="start end" class="secondary title">
            {{'CHANNELS.CATALOG_CONFIG.CAROUSEL.DIALOG.TITLE' | translate}}
        </h2>
        <button mat-icon-button type="button" class="ob-button small" (click)="close()">
            <mat-icon>close</mat-icon>
        </button>
    </div>
    <div mat-dialog-content fxLayout="column" fxLayoutAlign="start stretch">
        {{'CHANNELS.CATALOG_CONFIG.CAROUSEL.DIALOG.DESCRIPTION' | translate: {max: maxSelection} }}
        <div fxLayout="row wrap">
            <app-searchable-paginated-selection (loadData)="loadEvents($event)" [hideSearch]="false"
                [placeholder]="'CHANNELS.CATALOG_CONFIG.CAROUSEL.DIALOG.SEARCH_EVENTS' | translate" [form]="form.controls.events"
                [pageSize]="pageSize"
                [data$]="eventsData$" [metadata$]="eventsMetadata$" [loading$]="isLoading$">
                <ng-template #selectionTemplate let-pageForm="pageForm" let-data="data" let-selectionChanged="selectionChanged">
                    <app-selection-list [data]="data" [disabledOptionPredicate]="shouldDisableEvent"
                        [selectionChanged]="selectionChanged" class="small-rows" [pageForm]="pageForm"
                        [class.invalid-table]="this.form.controls.events.invalid && this.form.controls.events.touched">
                        <div slot="subheader" class="list-header">
                            <mat-checkbox fxHide />
                            <div class="list-header-label" fxFlex="0 1 100%">
                                {{'CHANNELS.CATALOG_CONFIG.CAROUSEL.DIALOG.EVENTS_COLUMN' | translate}}
                            </div>
                        </div>
                        <ng-template #optionTemplate let-row>
                            <span>{{row.event.name}}</span>
                        </ng-template>
                    </app-selection-list>
                </ng-template>
            </app-searchable-paginated-selection>
        </div>
    </div>

    <div mat-dialog-actions fxLayoutAlign="center center">
        <div class="footer-info" fxLayout="column" fxLayoutAlign="start">
            <span>
                {{ 'CHANNELS.CATALOG_CONFIG.CAROUSEL.DIALOG.MAX_INFO' | translate : { max: maxSelection, current: $selected().length} }}
            </span>
            <div *ngIf="$selected().length === maxSelection" class="max-reached-info"
                fxFlex="100%" fxLayout="row" fxLayoutAlign="start center">
                <mat-icon class="ob-icon xxsmall info with-text">info</mat-icon>
                <span class="tiny">
                    {{ 'CHANNELS.CATALOG_CONFIG.CAROUSEL.DIALOG.MAX_REACHED_INFO' | translate : { max: maxSelection } }}
                </span>
            </div>
        </div>
        <div fxFlex fxLayoutAlign="end">
            <div fxLayoutAlign="center start">
                <button type="button" mat-button class="ob-button" (click)="close()">
                    {{'FORMS.ACTIONS.CANCEL' | translate}}
                </button>
                <button #saveBtn mat-flat-button color="primary" type="button" class="ob-button"
                    [disabled]="!form.valid || !form.dirty" (click)="save()">
                    {{'FORMS.ACTIONS.OK' | translate}}
                </button>
            </div>
        </div>
    </div>
</div>

@if (isLoading$ | async) {
    <div class="spinner-container">
        <mat-spinner />
    </div>
}