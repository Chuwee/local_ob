@if(!$loading()) {
    <div class="price-types-matrix-container">
        @if($venueTemplate(); as template) {
            <form [formGroup]="pricesForm" class="flex flex-col">
                <div class="event-template-container flex flex-row justify-between">
                    <div class="details-non-editable-field flex flex-col">
                        <span class="field-label">{{'CHANNELS.PACKS.PACK_PRICE_TYPES.TEMPLATE' | translate}}</span>
                        <span>{{template.name}}</span>
                    </div>
                </div>
                <div class="flex flex-col">
                    <div class="prices-table-container">
                        @if(packPricesMatrix$ | async; as packPrices) {
                            <table mat-table formGroupName="pricesMatrix" id="pricesTable" class="ob-table" [dataSource]="packPrices">
                                <ng-container [matColumnDef]="pricesTableHead[0]" sticky>
                                    <th mat-header-cell *matHeaderCellDef class="head-cell border-right">
                                        {{'VENUE_TPLS.' + pricesTableHead[0] | translate}}
                                    </th>
                                    <td mat-cell *matCellDef="let row" class="border-right">
                                        <div class="title-price-column flex justify-start items-center">
                                            {{row[0]}}
                                        </div>
                                    </td>
                                </ng-container>
                                @for (rateName of rateNames; track $index) {
                                    <ng-container [matColumnDef]="rateName"
                                        [formArrayName]="rateName">
                                        <th mat-header-cell *matHeaderCellDef class="head-cell right price-column input-column">
                                            <div class="flex justify-end items-center">
                                                <span appEllipsify [matTooltip]="rateName">{{rateName}}</span>
                                            </div>
                                        </th>
                                        <td mat-cell *matCellDef="let row; index as j" class="right price-column editable-cell">
                                            <div class="write-value">
                                                @if(pricesMatrix.get([rateName,j])) {
                                                    <mat-form-field appearance="outline" class="ob-form-field">
                                                        @let errorMessage = pricesMatrix.get([rateName,j]) | obErrorMessage$ | async;
                                                        @if (errorMessage) {
                                                            <mat-icon matIconPrefix [obErrorIcon]="errorMessage">
                                                                error_outline
                                                            </mat-icon>
                                                        }
                                                        <app-currency-input [formControlName]="j" class="table-input"
                                                            [currencyCode]="$currencyCode()" [currencyFormat]="'narrow'"
                                                            [placeholder]="0 | localCurrency:$currencyCode():'narrow'" />
                                                    </mat-form-field>
                                                }
                                            </div>
                                        </td>
                                    </ng-container>
                                }
                                <tr mat-header-row *matHeaderRowDef="pricesTableHead" class="dense-row" ></tr>
                                <tr mat-row *matRowDef="let row; columns: pricesTableHead;" class="dense-row hoverable-row" ></tr>
                            </table>
                        }
                    </div>
                </div>
            </form>
        }
    </div>
}
@if($loading()) {
    <div class="spinner-container">
        <mat-spinner />
    </div>
}
