<div class="dialog-msg-container" fxLayout="column nowrap" fxFlex="100%">
    <div mat-dialog-title fxFlex="auto" fxLayout="row" fxFlexAlign="start">
        <h2 fxFlex="100%" class="secondary title">{{'TITLES.NEW_COLLECTIVE' | translate}}</h2>
        <button mat-icon-button type="button" class="ob-button small" (click)="close()">
            <mat-icon>close</mat-icon>
        </button>
    </div>
    <div mat-dialog-content fxLayout="column" fxLayoutAlign="start stretch">
        <form [formGroup]="form" fxLayout="column" fxLayoutAlign="start stretch">
            <ng-container *ngIf="entities$ | async">
                <ng-container *ngIf="(isOperator$ | async)">
                    <div class="ob-label ob-label-checkbox-group">
                        {{'COLLECTIVE.IS_GENERIC' | translate}} *
                    </div>
                    <div fxLayout="column">
                        <mat-checkbox fxFlex="40px" formControlName="generic" color="primary" class="app-checkbox-wrap-label">
                            {{('FORMS.LABELS.ENTITY' | translate) + ': ' + (operatorEntity$ | async) }}
                        </mat-checkbox>
                    </div>
                </ng-container>
                <mat-form-field appearance="outline" class="ob-form-field">
                    <mat-label>{{'FORMS.LABELS.ENTITY' | translate}}</mat-label>
                    <app-select-server-search formControlName="entity" [multiple]="false" required
                        [placeholder]="'FORMS.SELECT.PLACE_HOLDER' | translate"
                        [options$]="entities$" [moreOptionsAvailable$]="moreEntitiesAvailable$"
                        (loadOptions)="loadEntities($event.q, $event.nextPage)">
                    </app-select-server-search>
                    <mat-error [ob-form-errors]="form" field="entity"></mat-error>
                </mat-form-field>
            </ng-container>
            <mat-form-field appearance="outline" class="ob-form-field">
                <mat-label>{{'FORMS.LABELS.NAME' | translate}}</mat-label>
                <input matInput aria-label="name" [placeholder]="'FORMS.LABELS.NAME' | translate" formControlName="name">
                <mat-error [ob-form-errors]="form" field="name"></mat-error>
            </mat-form-field>
            <mat-form-field appearance="outline" class="ob-form-field">
                <mat-label>{{'FORMS.LABELS.TYPE' | translate}}</mat-label>
                <mat-select [placeholder]="'FORMS.SELECT.PLACE_HOLDER' | translate" formControlName="type">
                    <mat-option *ngFor="let type of types" [value]="type">
                        {{( 'COLLECTIVE.TYPE_OPTS.' + type ) | translate}}
                    </mat-option>
                </mat-select>
                <mat-error [ob-form-errors]="form" field="type"></mat-error>
            </mat-form-field>
            <mat-form-field *ngIf="(collectiveExternalValidators$ | async) && form.get('externalValidator').enabled" appearance="outline"
                class="ob-form-field">
                <mat-label>{{'FORMS.LABELS.EXTERNAL_VALIDATOR' | translate}}</mat-label>
                <mat-select [placeholder]="'FORMS.SELECT.ALL_ELEMENTS_FEMALE' | translate" formControlName="externalValidator">
                    <mat-option>
                        <app-select-search #externalValidatorSelectSearch [options$]="collectiveExternalValidators$"
                            [placeholderLabel]="'FORMS.SELECT.PLACE_HOLDER' | translate" searchField="name" requireSelection="true">
                        </app-select-search>
                    </mat-option>
                    <mat-option *ngFor="let externalValidator of externalValidatorSelectSearch.getFilteredOptions$() | async"
                        [value]="externalValidator">
                        <div appEllipsify [matTooltip]="externalValidator.name">
                            {{externalValidator.name}}
                        </div>
                    </mat-option>
                </mat-select>
                <mat-error [ob-form-errors]="form" field="entity"></mat-error>
            </mat-form-field>
            <mat-form-field appearance="outline" class="ob-form-field">
                <mat-label>{{'COLLECTIVE.VALIDATION_METHOD' | translate}}</mat-label>
                <mat-select [placeholder]="'FORMS.SELECT.PLACE_HOLDER' | translate" formControlName="validationMethod">
                    <mat-option *ngFor="let method of validationMethods" [value]="method">
                        {{( 'COLLECTIVE.VALIDATION_METHOD_OPTS.' + method ) | translate}}
                    </mat-option>
                </mat-select>
                <mat-error [ob-form-errors]="form" field="validationMethod"></mat-error>
            </mat-form-field>
        </form>
    </div>
    <div mat-dialog-actions fxFlex="auto" fxLayout="row no wrap" fxLayoutAlign="end">
        <button mat-button type="button" class="ob-button" (click)="close()">
            {{'FORMS.ACTIONS.CANCEL' | translate}}
        </button>
        <button mat-flat-button color="primary" type="button" class="ob-button" (click)="createCollective()" [disabled]="isSaving$ | async">
            {{'FORMS.ACTIONS.CREATE' | translate}}
        </button>
    </div>
</div>