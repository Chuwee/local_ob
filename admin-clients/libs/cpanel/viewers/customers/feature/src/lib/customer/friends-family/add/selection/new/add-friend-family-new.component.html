<div class="customer-form-container">
    @if ($newFriendFamilyForm(); as form) {
        <form [formGroup]="form" class="customer-form flex flex-col items-stretch">
            @let adminCustomerFields = $adminCustomerFieldNames();
            @if (adminCustomerFields.includes('name') || adminCustomerFields.includes('surname')) {
                <div class="flex flex-wrap justify-between md:gapx-5">
                    <!-- Title -->
                    @if (adminCustomerFields.includes('title')) {
                        <mat-form-field appearance="outline"
                            class="ob-form-field field-with-label flex shrink basis-full md:basis-[calc(50%-10px)]">
                            <mat-label>{{'CUSTOMER.TITLE' | translate}}</mat-label>
                            <mat-select formControlName="title" aria-label="title" [placeholder]="'FORMS.SELECT.PLACE_HOLDER' | translate">
                                @for (title of customerTitle; track title) {
                                    <mat-option [value]="title">
                                        {{('CUSTOMER.TITLE_OPTS.' + title) | translate}}
                                    </mat-option>
                                }
                            </mat-select>
                        </mat-form-field>
                    }
                    <!-- Name -->
                    @if (adminCustomerFields.includes('name')) {
                        <mat-form-field appearance="outline"
                            class="ob-form-field field-with-label flex shrink basis-full md:basis-[calc(50%-10px)]">
                            <mat-label>{{'CUSTOMER.NAME' | translate}}</mat-label>
                            <input matInput aria-label="name" [placeholder]="'CUSTOMER.NAME' | translate"
                                formControlName="name">
                            <mat-error [ob-form-errors]="form" field="name" />
                        </mat-form-field>
                    }
                    <!-- Surname -->
                    @if (adminCustomerFields.includes('surname')) {
                        <mat-form-field appearance="outline"
                            class="ob-form-field field-with-label flex shrink basis-full md:basis-[calc(50%-10px)]">
                            <mat-label>{{'CUSTOMER.SURNAME' | translate}}</mat-label>
                            <input matInput aria-label="surname" [placeholder]="'CUSTOMER.SURNAME' | translate"
                                formControlName="surname">
                            <mat-error [ob-form-errors]="form" field="surname" />
                        </mat-form-field>
                    }
                </div>
            }
            @if (adminCustomerFields.includes('birthday') || adminCustomerFields.includes('identification')) {
                <div class="flex flex-wrap justify-between md:gap-5">
                    <!-- Birthday -->
                    @if (adminCustomerFields.includes('birthday')) {
                        <mat-form-field appearance="outline"
                            class="ob-form-field field-with-label flex shrink basis-full md:basis-[calc(50%-10px)]">
                            <mat-label>{{'CUSTOMER.BIRTHDAY' | translate}}</mat-label>
                            <input matInput [matDatepicker]="birthdayDP" [placeholder]="dateFormat"
                                formControlName="birthday" (focus)="birthdayDP.open()" aria-label="birthday">
                            <button mat-icon-button matSuffix class="ob-button large no-hover-ripple"
                                (click)="$event.stopPropagation(); birthdayDP.open();">
                                <mat-icon>event</mat-icon>
                            </button>
                            <mat-datepicker #birthdayDP />
                        </mat-form-field>
                    }
                    <!-- Id Card -->
                    @if (adminCustomerFields.includes('identification')) {
                        <mat-form-field appearance="outline"
                            class="ob-form-field field-with-label flex shrink basis-full md:basis-[calc(50%-10px)]">
                            <mat-label>{{'CUSTOMER.ID_CARD' | translate}}</mat-label>
                            <input matInput aria-label="id card" [placeholder]="'CUSTOMER.ID_CARD' | translate"
                                formControlName="identification">
                        </mat-form-field>
                    }
                </div>
            }
            @if (adminCustomerFields.includes('gender') || adminCustomerFields.includes('language')) {
                <div class="flex flex-wrap justify-between md:gap-5">
                    @if (adminCustomerFields.includes('gender')) {
                        <!-- Gender -->
                        <mat-form-field appearance="outline"
                            class="ob-form-field field-with-label flex shrink basis-full md:basis-[calc(50%-10px)]">
                            <mat-label>{{'CUSTOMER.GENDER' | translate}}</mat-label>
                            <mat-select formControlName="gender" aria-label="gender"
                                [placeholder]="'FORMS.SELECT.PLACE_HOLDER' | translate">
                                <mat-option [value]="customerGenderNone">{{'FORMS.SELECT.PLACE_HOLDER' | translate}}</mat-option>
                                @for (gender of customerGender; track gender) {
                                    <mat-option [value]="gender">
                                        {{('CUSTOMER.GENDER_OPTS.' + gender) | translate}}
                                    </mat-option>
                                }
                            </mat-select>
                        </mat-form-field>
                    }
                    @if (adminCustomerFields.includes('language')) {
                        <!-- Language -->
                        <mat-form-field appearance="outline"
                            class="ob-form-field field-with-label flex shrink basis-full md:basis-[calc(50%-10px)]">
                            <mat-label>{{'CUSTOMER.LANGUAGE' | translate}}</mat-label>
                            <mat-select formControlName="language" aria-label="language"
                                [placeholder]="'FORMS.SELECT.PLACE_HOLDER' | translate">
                                @for(languageCode of $languageCodes(); track languageCode) {
                                    <mat-option
                                        [value]="languageCode">{{ ('LANGUAGES.' + languageCode ) | translate }}</mat-option>
                                }
                            </mat-select>
                        </mat-form-field>
                    }
                </div>
            }
            @if (adminCustomerFields.includes('country') || adminCustomerFields.includes('postal_code')) {
                <div class="flex flex-wrap justify-between md:gap-5" [formGroup]="form.controls.location">
                    <!-- Country -->
                    @if (adminCustomerFields.includes('country')) {
                        <mat-form-field appearance="outline"
                            class="ob-form-field field-with-label flex shrink basis-full md:basis-[calc(50%-10px)]">
                            <mat-label>{{'CUSTOMER.COUNTRY' | translate}}</mat-label>
                            <mat-select [placeholder]="'FORMS.SELECT.PLACE_HOLDER' | translate"
                                formControlName="country" aria-label="country">
                                <mat-option>
                                    <app-select-search #countrySelectSearch [options$]="countries$"
                                        [placeholderLabel]="'FORMS.SELECT.PLACE_HOLDER' | translate" searchField="name" />
                                </mat-option>
                                @for (country of (countrySelectSearch.getFilteredOptions$() | async); track country) {
                                    <mat-option [value]="country?.code">
                                        {{country ? country.name : ''}}
                                    </mat-option>
                                }
                            </mat-select>
                        </mat-form-field>
                    }
                    <!-- Postal Code-->
                    @if (adminCustomerFields.includes('postal_code')) {
                        <mat-form-field appearance="outline"
                            class="ob-form-field field-with-label flex shrink basis-full md:basis-[calc(50%-10px)]">
                            <mat-label>{{'CUSTOMER.POSTAL_CODE' | translate}}</mat-label>
                            <input matInput aria-label="postal code" [placeholder]="'CUSTOMER.POSTAL_CODE' | translate"
                                formControlName="postalCode">
                            <mat-error [ob-form-errors]="form.controls.location" field="postalCode" />
                        </mat-form-field>
                    }
                </div>
            }
            @if (adminCustomerFields.includes('province_code') || adminCustomerFields.includes('city')) {
                <div class="flex flex-wrap justify-between md:gap-5" [formGroup]="form.controls.location">
                    <!-- Country Subdivision -->
                    @if (adminCustomerFields.includes('province_code')) {
                        <mat-form-field appearance="outline"
                            class="ob-form-field field-with-label flex shrink basis-full md:basis-[calc(50%-10px)]">
                            <mat-label>{{'FORMS.LABELS.COUNTRY_SUBDIVISION' | translate}}</mat-label>
                            <mat-select [placeholder]="'FORMS.SELECT.PLACE_HOLDER' | translate"
                                formControlName="provinceCode" aria-label="province">
                                <mat-option>
                                    <app-select-search #provincesSelectSearch [options$]="$filteredProvinces()"
                                        [placeholderLabel]="'FORMS.SELECT.PLACE_HOLDER' | translate" searchField="name" />
                                </mat-option>
                                @for (province of (provincesSelectSearch.getFilteredOptions$() | async); track province) {
                                    <mat-option [value]="province?.code">
                                        {{province ? province.name : ''}}
                                    </mat-option>
                                }
                            </mat-select>
                        </mat-form-field>
                    }
                    <!-- City-->
                    @if (adminCustomerFields.includes('city')) {
                        <mat-form-field appearance="outline"
                            class="ob-form-field field-with-label flex shrink basis-full md:basis-[calc(50%-10px)]">
                            <mat-label>{{'CUSTOMER.CITY' | translate}}</mat-label>
                            <input matInput aria-label="city" [placeholder]="'CUSTOMER.CITY' | translate"
                                formControlName="city">
                            <mat-error [ob-form-errors]="form.controls.location" field="city" />
                        </mat-form-field>
                    }
                </div>
            }
            @if (adminCustomerFields.includes('address') || adminCustomerFields.includes('address_2') || adminCustomerFields.includes('phone')) {
                <div class="flex flex-wrap justify-between md:gapx-5">
                    <!-- Address -->
                    @if (adminCustomerFields.includes('address')) {
                        <mat-form-field appearance="outline"
                            class="ob-form-field field-with-label flex shrink basis-full md:basis-[calc(50%-10px)]">
                            <mat-label>{{'CUSTOMER.ADDRESS' | translate}}</mat-label>
                            <input matInput aria-label="address" [placeholder]="'CUSTOMER.ADDRESS' | translate"
                                [formControl]="form.controls.location.controls.address">
                            <mat-error [ob-form-errors]="form.controls.location" field="address" />
                        </mat-form-field>
                    }
                    <!-- Address 2 -->
                    @if (adminCustomerFields.includes('address_2')) {
                        <mat-form-field appearance="outline"
                            class="ob-form-field field-with-label flex shrink basis-full md:basis-[calc(50%-10px)]">
                            <mat-label>{{'CUSTOMER.ADDRESS_2' | translate}}</mat-label>
                            <input matInput aria-label="address_2" [placeholder]="'CUSTOMER.ADDRESS_2' | translate"
                                [formControl]="form.controls.address_2">
                            <mat-error [ob-form-errors]="form" field="address_2" />
                        </mat-form-field>
                    }
                    <!-- Phone -->
                    @if (adminCustomerFields.includes('phone')) {
                        <mat-form-field appearance="outline"
                            class="ob-form-field field-with-label flex shrink basis-full md:basis-[calc(50%-10px)]">
                            <mat-label>{{'CUSTOMER.PHONE' | translate}}</mat-label>
                            <input matInput aria-label="phone" formControlName="phone" [placeholder]="'CUSTOMER.PHONE' | translate">
                            <mat-error [ob-form-errors]="form" field="phone" />
                        </mat-form-field>
                    }
                    <!-- Phone 2 -->
                    @if (adminCustomerFields.includes('phone_2')) {
                        <mat-form-field class="ob-form-field field-with-label flex shrink basis-full md:basis-[calc(50%-10px)]"
                            appearance="outline">
                            <mat-label>{{'CUSTOMER.PHONE_2' | translate}}</mat-label>
                            <input matInput aria-label="phone_2" [placeholder]="'CUSTOMER.PHONE_2' | translate"
                                formControlName="phone_2">
                            <mat-error [ob-form-errors]="form" field="phone_2"></mat-error>
                        </mat-form-field>
                    }
                </div>
            }
            @if (adminCustomerFields.length) {
                <div class="flex flex-wrap justify-between md:gap-5">
                    <!-- Email -->
                    @if (adminCustomerFields.includes('email')) {
                        <mat-form-field appearance="outline"
                            class="ob-form-field field-with-label flex shrink basis-full md:basis-[calc(50%-10px)]">
                            <mat-label>{{'CUSTOMER.EMAIL' | translate}}</mat-label>
                            <input matInput aria-label="email" formControlName="email"
                                [placeholder]="'CUSTOMER.EMAIL' | translate">
                            <mat-error [ob-form-errors]="form" field="email" />
                        </mat-form-field>
                    }
                    <!-- Member Id -->
                    @if ($entityMemberIdGeneration() === 'DEFAULT') {
                        <mat-form-field appearance="outline"
                            class="ob-form-field field-with-label flex shrink basis-full md:basis-[calc(50%-10px)]">
                            <mat-label>{{'CUSTOMER.MEMBER_ID' | translate}}</mat-label>
                            <input matInput aria-label="member id" formControlName="memberId"
                                [placeholder]="'CUSTOMER.MEMBER_ID' | translate">
                            <mat-error [ob-form-errors]="form" field="memberId" />
                        </mat-form-field>
                    }
                </div>
            }
        </form>
    }
</div>