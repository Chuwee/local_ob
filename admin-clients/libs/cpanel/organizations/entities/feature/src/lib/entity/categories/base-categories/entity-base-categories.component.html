<app-form-container (cancel)="reload()" (save)="save()" layout="menu" [disabled]="!form.dirty" [formGroup]="form">
    <div class="section-block">
        <mat-checkbox color="primary" formControlName="useOwnCategories">
            {{'ENTITY.CATEGORIES.USE_OWN_CATEGORIES' | translate}}
        </mat-checkbox>
    </div>
    <mat-accordion [multi]="true" [togglePosition]="'before'">
        @for (category of (mapCategories$ | async) | keyvalue; track category.key) {
            <mat-expansion-panel expanded togglePosition="before">
                <mat-expansion-panel-header expandedHeight="*" collapsedHeight="*">
                    <mat-panel-title>
                        {{'ENTITY.CATEGORY_OPTS.' + category.key | translate}}
                    </mat-panel-title>
                </mat-expansion-panel-header>
                <div class="grid grid-cols-2 md:grid-cols-3">
                    @for (subcategory of category.value | keyvalue; track subcategory.key) {
                        <div>
                            <mat-checkbox class="base-category-wrapper" color="primary"
                                [checked]="form.get('categories').value.includes(subcategory.value)"
                                (change)="doChange($event.checked, +subcategory.value)">
                                {{'ENTITY.CATEGORY_OPTS.' + subcategory.key | translate}}
                            </mat-checkbox>
                        </div>
                    }
                </div>
            </mat-expansion-panel>
        }
    </mat-accordion>
</app-form-container>
@if (reqInProgress$ | async) {
    <div class="spinner-container">
        <mat-spinner />
    </div>
}