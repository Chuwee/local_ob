
<form [formGroup]="filtersForm" class="flex flex-col gap-4">
    <app-context-notification contextType="info" class="min-padding full">
        {{'TICKET.POPOVER_FILTER_MSG' | translate}}
    </app-context-notification>
    <div class="flex flex-col gap-6">
        @if ($areCurrenciesShown()) {
            <app-filter-currency-list
                [formControl]="filtersForm.get(formControlNames.currency)"
                [startDate]="startDate"
                [endDate]="endDate" />
        }
        <div class="filter-block flex flex-row">
            <div class="ob-label flex-[0_0_124px]">
                {{'FORMS.LABELS.CHANNEL_ENTITY' | translate}}
            </div>
            <div class="filter-block-input sm:flex-[0_0_540px] basis-full">
                <mat-form-field appearance="outline" class="ob-form-field">
                    <app-select-server-search [formControlName]="formControlNames.channelEntity"
                        [options$]="channelEntities$" [moreOptionsAvailable$]="moreChannelEntitiesAvailable$"
                        (loadOptions)="loadFilterChannelEntities($event.q, $event.nextPage)" />
                </mat-form-field>
            </div>
        </div>
        <div class="filter-block flex flex-row">
            <div class="ob-label flex-[0_0_124px]">
                {{'FORMS.LABELS.EVENT_ENTITY' | translate}}
            </div>
            <div class="filter-block-input sm:flex-[0_0_540px] basis-full">
                <mat-form-field appearance="outline" class="ob-form-field">
                    <app-select-server-search [formControlName]="formControlNames.eventEntity"
                        [options$]="eventEntities$" [moreOptionsAvailable$]="moreEventEntitiesAvailable$"
                        (loadOptions)="loadFilterEventEntities($event.q, $event.nextPage)" />
                </mat-form-field>
            </div>
        </div>
        <mat-divider [inset]="true" class="filter-divider" />
        <div class="filter-block flex flex-row">
            <div class="ob-label flex-[0_0_124px]">
                {{'FORMS.LABELS.CHANNEL' | translate}}
            </div>
            <div class="filter-block-input sm:flex-[0_0_540px] basis-full">
                <mat-form-field appearance="outline" class="ob-form-field">
                    <app-select-server-search [multiple]="true" [formControlName]="formControlNames.channel"
                        [unselectLabel]="'FORMS.ACTIONS.UNSELECT_ALL' | translate"
                        [options$]="channels$" [moreOptionsAvailable$]="moreChannelsAvailable$"
                        (loadOptions)="loadFilterChannels($event.q, $event.nextPage)" />
                </mat-form-field>
            </div>
        </div>
        <div class="filter-block flex sm:flex-row sm:gap-0 flex-col gap-6  place-content-between">
            <div class="flex flex-row basis-full">
                <div class="ob-label flex-[0_0_124px]">
                    {{'FORMS.LABELS.STATE' | translate}}
                </div>
                <div class="filter-block-input flex basis-full">
                    <mat-form-field appearance="outline" class="ob-form-field sm:flex-[0_0_180px] basis-full">
                        <mat-select [formControlName]="formControlNames.state">
                            @for (state of statesList; track $index) {
                                <mat-option [value]="state">
                                    {{state && (state.name | translate)}}
                                </mat-option>
                            }
                        </mat-select>
                    </mat-form-field>
                </div>
            </div>
            <div class="flex flex-row">
                <div class="ob-label flex-[0_0_124px]">
                    {{'FORMS.LABELS.PRINT' | translate}}
                </div>
                <div class="filter-block-input flex basis-full">
                    <mat-form-field appearance="outline" class="ob-form-field sm:flex-[0_0_180px] basis-full">
                        <mat-select [formControlName]="formControlNames.printStatus"
                            [placeholder]="'FORMS.SELECT.ALL_ELEMENTS_MALE' | translate">
                            <mat-option [value]="null">
                                {{'FORMS.ACTIONS.UNSELECT_ALL' | translate}}
                            </mat-option>
                            @for (printStatus of printList; track $index) {
                                <mat-option [value]="printStatus">
                                    {{printStatus && (printStatus.name | translate)}}
                                </mat-option>
                            }
                        </mat-select>
                    </mat-form-field>
                </div>
            </div>
        </div>
        @if ($showReallocationRefund()) {
            <div class="flex filter-block">
                <div class="field-without-label">
                    <mat-checkbox color="primary" [formControlName]="formControlNames.reallocationRefund">
                        {{'FORMS.LABELS.REFUND_FOR_REALLOCATE' | translate}}
                    </mat-checkbox>
                </div>
            </div>
        }
        <div class="filter-block flex flex-row justify-between">
            <div class="ob-label flex-[0_0_124px]">
                {{'FORMS.LABELS.ORIGIN_MARKET' | translate}}
            </div>
            <div class="filter-block-input flex basis-full">
                <mat-form-field appearance="outline" class="ob-form-field sm:flex-[0_0_180px] basis-full">
                    <mat-select [formControlName]="formControlNames.originMarket"
                        [placeholder]="'FORMS.SELECT.ALL_ELEMENTS_MALE' | translate">
                        <mat-option [value]="null">
                            {{'FORMS.SELECT.ALL_ELEMENTS_MALE' | translate}}
                        </mat-option>
                        @for(originMarket of originMarketsList; track originMarket.id){
                            <mat-option [value]="originMarket">
                                {{originMarket && (originMarket.name | translate)}}
                            </mat-option>
                        }
                    </mat-select>
                </mat-form-field>
            </div>
        </div>

        <div class="filter-block flex sm:flex-row sm:gap-0 flex-col gap-6 justify-between">
            <div class="flex flex-row">
                <div class="ob-label flex-[0_0_124px]">
                    {{'FORMS.LABELS.VALIDATION' | translate}}
                </div>
                <div class="filter-block-input flex basis-full">
                    <mat-form-field appearance="outline" class="ob-form-field sm:flex-[0_0_180px] basis-full">
                        <mat-select [formControlName]="formControlNames.validationStatus"
                            [placeholder]="'FORMS.SELECT.ALL_ELEMENTS_MALE' | translate">
                            <mat-option [value]="null">
                                {{'FORMS.ACTIONS.UNSELECT_ALL' | translate}}
                            </mat-option>
                            @for (validationStatus of validationList; track $index) {
                                <mat-option [value]="validationStatus">
                                    {{validationStatus && (validationStatus.name | translate)}}
                                </mat-option>
                            }
                        </mat-select>
                    </mat-form-field>
                </div>
            </div>
            <div class="flex flex-row">
                <div class="ob-label flex-[0_0_124px]">
                    {{'FORMS.LABELS.TICKET_TYPE' | translate}}
                </div>
                <div class="filter-block-input flex basis-full">
                    <mat-form-field appearance="outline" class="ob-form-field sm:flex-[0_0_180px] basis-full">
                        <mat-select [formControlName]="formControlNames.ticketType"
                            [placeholder]="'FORMS.SELECT.ALL_ELEMENTS_MALE' | translate">
                            <mat-option [value]="null">
                                {{'FORMS.ACTIONS.UNSELECT_ALL' | translate}}
                            </mat-option>
                            @for (type of typesList; track $index) {
                                <mat-option [value]="type">
                                    {{type && (type.name | translate)}}
                                </mat-option>
                            }
                        </mat-select>
                    </mat-form-field>
                </div>
            </div>
        </div>
        <div class="filter-block flex flex-row  justify-between">
            <div class="ob-label flex-[0_0_124px]">
                {{'FORMS.LABELS.PROFESSIONAL_CLIENT' | translate}}
            </div>
            <div class="filter-block-input flex basis-full">
                <mat-form-field appearance="outline" class="ob-form-field sm:flex-[0_0_180px] basis-full">
                    <app-select-server-search [formControlName]="formControlNames.client"
                        [unselectLabel]="'FORMS.ACTIONS.UNSELECT_ALL' | translate" [multiple]="true"
                        [options$]="clients$" [moreOptionsAvailable$]="moreClientsAvailable$"
                        (loadOptions)="loadFilterClients($event.q, $event.nextPage)" />
                </mat-form-field>
            </div>
        </div>
        <mat-divider [inset]="true" class="filter-divider" />
        <div class="filter-block flex flex-row ">
            <div class="ob-label flex-[0_0_124px]">
                {{'FORMS.LABELS.EVENT' | translate}}
            </div>
            <div class="filter-block-input flex basis-full">
                <mat-form-field appearance="outline" class="ob-form-field sm:flex-[0_0_540px] basis-full">
                    <app-select-server-search [multiple]="true" [formControlName]="formControlNames.event"
                        [unselectLabel]="'FORMS.ACTIONS.UNSELECT_ALL' | translate"
                        [options$]="events$" [moreOptionsAvailable$]="moreEventsAvailable$"
                        (loadOptions)="loadFilterEvents($event.q, $event.nextPage)" />
                </mat-form-field>
            </div>
        </div>
        <div class="flex filter-block">
            <div class="ob-label flex-[0_0_124px]">
                {{'FORMS.LABELS.SESSION_DATE' | translate}}
            </div>
            <div class="filter-block-input filter-block-time-picker flex flex-[100%] flex-row justify-start items-center">
                <app-date-time-picker id="start_date" maxErrors="1" class="date-form-field flex-[0_1_100%]"
                    defaultTime="00:00" [formControlName]="formControlNames.sessionDateFrom"
                    [max]="filtersForm.get(formControlNames.sessionDateTo).value" />
                <app-date-time-picker id="end_date" maxErrors="1" class="date-form-field flex-[0_1_100%]"
                    [formControlName]="formControlNames.sessionDateTo"
                    [min]="filtersForm.get(formControlNames.sessionDateFrom).value" />
                @if (filtersForm.get(formControlNames.sessionDateFrom).value) {
                    <button (click)="clearSessionDates()"
                        [matTooltip]="'TICKET.REMOVE_SESSION_DATES_FILTER' | translate"
                        mat-icon-button class="ob-button small clear-dates-bt">
                        <mat-icon>clear</mat-icon>
                    </button>
                }
            </div>
        </div>
        <div class="filter-block flex flex-row">
            <div class="ob-label flex-[0_0_124px]">
                {{'FORMS.LABELS.SESSION' | translate}}
            </div>
            <div class="filter-block-input flex basis-full">
                <mat-form-field appearance="outline" class="ob-form-field sm:flex-[0_0_540px] basis-full">
                    <app-select-server-search [multiple]="true" [unselectLabel]="'FORMS.ACTIONS.UNSELECT_ALL' | translate"
                        [formControlName]="formControlNames.session" [placeholder]="'FORMS.SELECT.ALL_ELEMENTS_FEMALE' | translate"
                        [options$]="sessions$" [moreOptionsAvailable$]="moreSessionsAvailable$"
                        (loadOptions)="loadFilterSessions($event.q, $event.nextPage)">
                        <ng-template #optionTemplate let-row>
                            {{row.date_start | dateTime : dateTimeFormats.shortDateTime}} - {{row.name}}
                        </ng-template>
                    </app-select-server-search>
                </mat-form-field>
            </div>
        </div>
        <div class="filter-block flex flex-row">
            <div class="ob-label flex-[0_0_124px]">
                {{'FORMS.LABELS.SECTORS' | translate}}
            </div>
            <div class="filter-block-input flex basis-full">
                <mat-form-field appearance="outline" class="ob-form-field sm:flex-[0_0_540px] basis-full">
                    <app-select-server-search multiple="true" [formControlName]="formControlNames.sector"
                        [unselectLabel]="((sectors$ | async)?.length || (loadingSectors$ | async) ?
                        'FORMS.ACTIONS.UNSELECT_ALL' : 'TICKET.NO_RESULTS_FOR_MULTIPLE_VENUE_TEMPLATES') | translate"
                        [placeholder]="'FORMS.SELECT.ALL_ELEMENTS_MALE' | translate"
                        [options$]="sectors$" [moreOptionsAvailable$]="moreSectorsAvailable$"
                        (loadOptions)="loadFilterSectors($event.q, $event.nextPage)" />
                </mat-form-field>
            </div>
        </div>
        <div class="filter-block flex flex-row">
            <div class="ob-label flex-[0_0_124px]">
                {{'FORMS.LABELS.PRICE_TYPES' | translate}}
            </div>
            <div class="filter-block-input flex basis-full">
                <mat-form-field appearance="outline" class="ob-form-field sm:flex-[0_0_540px] basis-full">
                    <app-select-server-search multiple="true" [formControlName]="formControlNames.priceType"
                        [unselectLabel]="((priceTypes$ | async)?.length || (loadingPriceTypes$ | async) ?
                        'FORMS.ACTIONS.UNSELECT_ALL' : 'TICKET.NO_RESULTS_FOR_MULTIPLE_VENUE_TEMPLATES') | translate"
                        [placeholder]="'FORMS.SELECT.ALL_ELEMENTS_FEMALE' | translate"
                        [options$]="priceTypes$" [moreOptionsAvailable$]="morePriceTypesAvailable$"
                        (loadOptions)="loadFilterPriceTypes($event.q, $event.nextPage)" />
                </mat-form-field>
            </div>
        </div>
    </div>
</form>
