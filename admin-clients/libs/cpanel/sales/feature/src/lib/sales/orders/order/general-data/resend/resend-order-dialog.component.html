<div class="dialog-msg-container" fxLayout="column nowrap" fxFlex="100%">
    <div mat-dialog-title fxFlex="auto" fxLayout="row" fxFlexAlign="start">
        <h2 fxFlex="100%" class="secondary title">{{'TITLES.RESEND_ORDER' | translate}}</h2>
        <button mat-icon-button type="button" class="ob-button small" (click)="close()">
            <mat-icon>close</mat-icon>
        </button>
    </div>
    <div mat-dialog-content fxLayout="column" fxLayoutAlign="start stretch">
        <form [formGroup]="resendOrderForm" fxLayout="column" fxLayoutAlign="start stretch">
            <mat-form-field appearance="outline" class="ob-form-field">
                <mat-label>{{'FORMS.LABELS.EMAIL' | translate}}</mat-label>
                <input matInput aria-label="email" [placeholder]="'FORMS.LABELS.EMAIL' | translate" formControlName="email_address">
                <mat-error [ob-form-errors]="resendOrderForm.controls.email_address"></mat-error>
            </mat-form-field>
            <mat-form-field appearance="outline" class="ob-form-field">
                <mat-label>{{'FORMS.LABELS.SUBJECT' | translate}}</mat-label>
                <input matInput aria-label="subject" [placeholder]="'FORMS.LABELS.SUBJECT' | translate" formControlName="subject">
                <mat-error [ob-form-errors]="resendOrderForm.controls.subject"></mat-error>
            </mat-form-field>
            <mat-form-field appearance="outline" class="ob-form-field">
                <mat-label>{{'FORMS.LABELS.BODY' | translate}}</mat-label>
                <textarea matInput cdkTextareaAutosize cdkAutosizeMinRows="1" cdkAutosizeMaxRows="5" aria-label="body"
                    [placeholder]="'FORMS.LABELS.BODY' | translate" formControlName="body"></textarea>
                <mat-error [ob-form-errors]="resendOrderForm.controls.body"></mat-error>
            </mat-form-field>
            <div *ngIf="canResendWhatsapp || (isOperatorUser$ | async)" fxLayout="column">
                <mat-divider class="ob-divider"></mat-divider>
                <div *ngIf="isOperatorUser$ | async" class="force-generation-container">
                    <mat-checkbox color="primary" formControlName="full_regeneration" fxLayout="row wrap" fxLayoutAlign="start start">
                        {{'RESEND_ORDER.FORCE_REGENERATION.LABEL' | translate}}
                    </mat-checkbox>
                    <p *ngIf="resendOrderForm.value.full_regeneration" fxLayoutAlign="start"
                        class="description">
                        <mat-icon class="warning">warning</mat-icon>
                        {{'RESEND_ORDER.FORCE_REGENERATION.WARNING' | translate}}
                    </p>
                </div>

                <div *ngIf="canResendWhatsapp">
                    <mat-checkbox formControlName="resend_whatsapp" [class.resend-to-whatsapp]="(showPhone$ | async)"
                        color="primary">
                        {{'RESEND_ORDER.RESEND_WHATSAPP' | translate}}
                    </mat-checkbox>
                    <form [formGroup]="phoneForm" *ngIf="showPhone$ | async" fxLayout="column">
                        <div fxLayout="row" fxLayoutGap="16px" fxFlex="100%">
                            <div fxFlex="22.5%">
                                <mat-form-field fxFlex="100%" appearance="outline" class="ob-form-field">
                                    <mat-label>{{'FORMS.LABELS.PHONE_PREFIX' | translate}}</mat-label>
                                    <mat-select formControlName="prefix" placeholder="{{'FORMS.LABELS.PHONE_PREFIX' | translate }}"
                                        [required]="true">
                                        <mat-select-trigger>
                                            +{{selectedPrefix$ | async}}
                                        </mat-select-trigger>
                                        <mat-option *ngFor="let prefix of prefixes$ | async"
                                            [value]="prefix.value">{{prefix.name + ' (+' + prefix.value + ')'}}</mat-option>
                                    </mat-select>
                                    <mat-error [ob-form-errors]="phoneForm.get('prefix')"></mat-error>
                                </mat-form-field>
                            </div>
                            <div fxFlex="42.5%">
                                <mat-form-field fxFlex="100%" appearance="outline" class="ob-form-field">
                                    <mat-label>{{'FORMS.LABELS.PHONE_NUMBER' | translate}}</mat-label>
                                    <input matInput aria-label="number" [placeholder]="'FORMS.LABELS.PHONE_NUMBER' | translate"
                                        formControlName="number" />
                                    <mat-error [ob-form-errors]="phoneForm.get('number')"></mat-error>
                                </mat-form-field>
                            </div>
                        </div>
                        <div fxLayout="row" fxLayoutAlign="start start">
                            <mat-icon class="ob-icon small info with-text">info</mat-icon>
                            <span>{{'RESEND_ORDER.RESEND_WHATSAPP_INFO' | translate}}</span>
                        </div>
                    </form>
                </div>
            </div>
        </form>
    </div>
    <div mat-dialog-actions fxLayoutAlign="end">
        <button type="button" mat-button class="ob-button" (click)="close()">
            {{'FORMS.ACTIONS.CANCEL' | translate}}
        </button>
        <button mat-flat-button color="primary" type="button" class="ob-button" (click)="resendOrder()" [disabled]="!resendOrderForm.valid">
            {{'FORMS.ACTIONS.RESEND' | translate}}
        </button>
    </div>
</div>