<div class="dialog-msg-container" fxLayout="column nowrap" fxFlex="100%">
    <div mat-dialog-title fxFlex="auto" fxLayout="row" fxFlexAlign="start">
        <h2 fxFlex="100%" class="secondary title">{{'TITLES.RESEND_CODES' | translate}}</h2>
        <button mat-icon-button type="button" class="ob-button small" (click)="close()">
            <mat-icon>close</mat-icon>
        </button>
    </div>
    <div mat-dialog-content fxLayout="column" fxLayoutAlign="start stretch">
        <form [formGroup]="form" fxLayout="column" fxLayoutAlign="start stretch">
            <mat-radio-group fxLayout="column" formControlName="resendSourceSelector">
                <mat-radio-button class="ob-radio-button"
                    [value]="externalPermissionsResendSources.fromEventAndSession">
                    {{'ORDERS.RESEND_CODES.FROM_EVENT_AND_SESSION' | translate}}
                </mat-radio-button>
                <div fxLayout="column" fxFlexOffset="40px">
                    <mat-form-field appearance="outline" class="ob-form-field">
                        <mat-label>{{'FORMS.LABELS.EVENT' | translate}}</mat-label>
                        <app-select-server-search [multiple]="false"
                            [placeholder]="'FORMS.SELECT.PLACE_HOLDER' | translate" formControlName="event"
                            [options$]="events$" [moreOptionsAvailable$]="moreEventsAvailable$"
                            (loadOptions)="loadEvents($event.q, $event.nextPage)">
                        </app-select-server-search>
                        <mat-error [ob-form-errors]="form" field="event"></mat-error>
                    </mat-form-field>
                    <mat-form-field appearance="outline" class="ob-form-field">
                        <mat-label>{{'FORMS.LABELS.SESSION' | translate}}</mat-label>
                        <app-select-server-search [multiple]="false"
                            [placeholder]="'FORMS.SELECT.PLACE_HOLDER' | translate" formControlName="session"
                            [options$]="sessions$" [moreOptionsAvailable$]="moreSessionsAvailable$"
                            (loadOptions)="loadSessions($event.q, $event.nextPage)">
                        </app-select-server-search>
                    </mat-form-field>
                </div>
                <mat-radio-button class="ob-radio-button" [value]="externalPermissionsResendSources.fromDateRange">
                    {{'ORDERS.RESEND_CODES.FROM_DATE_RANGE' | translate}}
                </mat-radio-button>
                <div fxFlexOffset="20px" fxLayout="row wrap" fxLayoutGap="10px" class="date-time-picker-container">
                    <app-date-time-picker id="start_date" maxErrors="1" label="{{'FORMS.FROM' | translate}}"
                        fxFlex="1 0 260px" class="date-form-field" formControlName="startDate"
                        [max]="form.get('endDate').value">
                    </app-date-time-picker>
                    <app-date-time-picker id="end_date" maxErrors="1" label="{{'FORMS.TO' | translate}}"
                        fxFlex="1 0 260px" class="date-form-field" formControlName="endDate"
                        [min]="form.get('startDate').value" [required]="true">
                    </app-date-time-picker>
                </div>
                <mat-radio-button class="ob-radio-button" [value]="externalPermissionsResendSources.fromOrder">
                    {{'ORDERS.RESEND_CODES.FROM_ORDER' | translate}}
                </mat-radio-button>
                <div fxLayout="column" fxFlexOffset="40px">
                    <mat-form-field appearance="outline" class="ob-form-field">
                        <mat-label>{{'FORMS.LABELS.CODE' | translate}}</mat-label>
                        <input matInput [placeholder]="'ORDERS.RESEND_CODES.ORDER_CODE_PLACE_HOLDER' | translate"
                            formControlName="orderCode">
                        <mat-error [ob-form-errors]="form" field="orderCode"></mat-error>
                    </mat-form-field>
                </div>
            </mat-radio-group>
            <mat-divider fxFlex="100%"></mat-divider>
            <div fxLayout="row" fxFlexOffset="50px">
                <mat-form-field fxFlex="92%" appearance="outline" class="ob-form-field inline-field">
                    <mat-label>{{'FORMS.LABELS.RESEND_METHOD' | translate}}</mat-label>
                    <mat-select [placeholder]="'FORMS.SELECT.PLACE_HOLDER' | translate" formControlName="resendMethod">
                        <mat-option *ngFor="let method of externalPermissionsResendMethodsList" [value]="method">
                            {{method}}
                            <span class="default-option-tag" *ngIf="method === externalPermissionsResendMethods.insert">
                                {{'ORDERS.RESEND_CODES.DEFAULT_OPTION'| translate}}
                            </span>
                        </mat-option>
                    </mat-select>
                    <app-help-button matSuffix [message]="'ORDERS.RESEND_CODES.RESEND_METHOD_DESCRIPTION' | translate">
                    </app-help-button>
                    <mat-error [ob-form-errors]="form" field="resendMethod"></mat-error>
                </mat-form-field>
            </div>
        </form>
    </div>
    <div mat-dialog-actions fxLayout="row" fxLayoutAlign="end">
        <button type="button" mat-button class="ob-button" (click)="close()">
            {{'FORMS.ACTIONS.CANCEL' | translate}}
        </button>
        <button mat-flat-button color="primary" type="button" class="ob-button" (click)="resendCodes()"
            [disabled]="form.invalid || (isResending$ | async)">
            {{'FORMS.ACTIONS.RESEND' | translate}}
        </button>
    </div>
</div>
<div *ngIf="isResending$ | async" class="spinner-container">
    <mat-spinner></mat-spinner>
</div>
